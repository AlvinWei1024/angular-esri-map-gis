// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See http://js.arcgis.com/3.14/esri/copyright.txt for details.
//>>built
define("esri/renderers/smartMapping","require module dojo/_base/array dojo/_base/lang dojo/has dojo/Deferred dojo/DeferredList dojo/promise/all dojo/when ../kernel ../Color ../numberUtils ../styles/type ../styles/size ../styles/choropleth ../styles/heatmap ../symbols/SimpleMarkerSymbol ../symbols/SimpleLineSymbol ../symbols/SimpleFillSymbol ./UniqueValueRenderer ./ClassBreaksRenderer ./HeatmapRenderer ./BlendRenderer ./utils dojo/i18n!../nls/jsapi".split(" "),function(U,ja,y,z,ka,v,H,la,ma,na,l,I,
V,W,X,Y,oa,P,pa,qa,J,ra,sa,E,ta){function m(a,c){a.reject(Error(c))}function w(a,c,b,d){var e;switch(b){case "point":e=new oa;e.setColor(c);e.setSize(null!=d?d:a.size);c=new P;c.setColor(a.outline.color);c.setWidth(a.outline.width);e.setOutline(c);break;case "line":e=new P;e.setColor(c);e.setWidth(null!=d?d:a.width);break;case "polygon":e=new pa,e.setColor(c),c=new P,c.setColor(a.outline.color),c.setWidth(a.outline.width),e.setOutline(c)}return e}function F(a){a=a.geometryType;"esriGeometryPoint"===
a||"esriGeometryMultipoint"===a?a="point":"esriGeometryPolyline"===a?a="line":"esriGeometryPolygon"===a&&(a="polygon");return a}function Q(a,c){var b=a.scheme;b=b?V.cloneScheme(b):(b=V.getSchemes({theme:a.theme||ua,basemap:a.basemap,geometryType:c}))&&b.primaryScheme;return b}function Z(a,c){return a.label<c.label?-1:a.label>c.label?1:0}function $(a,c){return a.value<c.value?-1:a.value>c.value?1:0}function va(a,c){var b=c.count-a.count;0===b&&(b=Z(a,c));return b}function wa(a,c){var b=c.count-a.count;
0===b&&(b=$(a,c));return b}function xa(a,c,b){var d;"count"===c?(d=wa,b&&b.codedValues&&(d=va)):"value"===c&&(d=$,b&&b.codedValues&&(d=Z));d&&a.sort(d)}function ya(a,c,b,d){var e=a.uniqueValueInfos,f=b.layer,h=b.field,g=f.getField(h),r=f.getDomain(g.name),k,q=-1,p,n=null==b.numTypes?10:-1===b.numTypes?e.length:b.numTypes,m=null==b.showOthers?!0:b.showOthers,u=null==b.sortBy?"count":b.sortBy,s=b&&b.labelCallback,t=F(f),B=Q(b,t),f=new qa(null,h),l={domain:r,fieldInfo:g};y.forEach(e,function(a,c){l.value=
a.value;a.label=E.createUniqueValueLabel(l);s&&(a.label=s(a));null===a.value&&(q=c)});-1<q&&(p=e.splice(q,1)[0]);xa(e,u,r);l.dateFormatInterval=E.calculateDateFormatInterval(y.map(y.filter(e,function(a,c){return c<n}),function(a){return a.value}));k=C.createColors(B.colors,e.length);y.forEach(e,function(a,c){l.value=a.value;a.label=E.createUniqueValueLabel(l);s&&(a.label=s(a));a.symbol=w(B,k[c],t)});k=C.createColors(B.colors,n);for(g=0;g<n;g++)(r=e[g])&&f.addValue({value:r.value,label:r.label,symbol:w(B,
k[g],t)});m&&(f.defaultSymbol=w(B,B.noDataColor,t),f.defaultLabel=G.other);p&&(p.symbol=w(B,B.noDataColor,t),e.push(p));c&&c.widthInfo&&f.setVisualVariables([c.widthInfo]);d.resolve({renderer:f,uniqueValueInfos:e,source:a.source,othersStartIndex:f.infos.length===e.length?-1:f.infos.length,scheme:Q(b,t)})}function K(a,c,b){var d=a.scheme;d=d?X.cloneScheme(d):(d=X.getSchemes({theme:b||a.theme||za,basemap:a.basemap,geometryType:c}))&&d.primaryScheme;return d}function R(a){var c=a.avg,b=c-a.stddev,d=
c+a.stddev;b<a.min&&(b=a.min);d>a.max&&(d=a.max);a=I.round([b,d]);b=a[0];d=a[1];a=[b,b+(c-b)/2,c,c+(d-c)/2,d];return I.round(a)}function Aa(a,c,b){var d=(c-a)/(b-1),e,f=[a];for(e=1;e<=b-2;e++)f.push(a+e*d);f.push(c);return I.round(f)}function L(a,c){var b,d;if(null==a.min)b=0,d=100;else if(a.min===a.max)0>a.min?(b=2*a.min,d=0):0<a.min?(b=0,d=2*a.min):(b=0,d=100);else if(c&&(null==a.avg||null==a.stddev))b=a.min,d=a.max;return null!=b?[b,d]:null}function aa(a,c,b,d,e,f,h){var g=null==f.useDefaultStatistics?
!0:f.useDefaultStatistics;if(a&&!a.count&&!g)m(h,"smartMapping.createColorRenderer: cannot create renderer when statistics.count is 0.");else{var r=f.field,k=F(f.layer),q=null==f.showOthers?!0:f.showOthers,p=K(f,k),n=f.semiContinuous,x,u,s,t=c&&c.classBreakInfos,B=t&&t.length,v=c?B:5;if(p){var A=c&&-1<p.id.indexOf("seq-")?ba(p,{length:v}):C.createColors(p.colors,v);if(A.length<v)m(h,"smartMapping.createColorRenderer: not enough colors in the scheme.");else{var D=new J(null,r);q&&(D.defaultSymbol=
w(p,p.noDataColor,k),D.defaultLabel=G.other);D.addBreak({minValue:-M,maxValue:M,symbol:w(p,p.noDataColor,k)});if(c){x=[];var z;1===B?(u=[t[0].minValue,t[0].maxValue],x=[0,1],z=C.createColors(A,v)[0],s=[z,new l(z)]):n?(u=[],s=[],y.forEach(t,function(a,c){var b=0.1*(a.maxValue-a.minValue);0===c?u.push(a.minValue):u.push(a.minValue+b);c===B-1?u.push(a.maxValue):u.push(a.maxValue-b);z=new l(A[c]);s.push(z);s.push(new l(z));x.push(2*c);x.push(2*c+1)})):(u=y.map(t,function(a,c){x.push(c);return(a.minValue+
a.maxValue)/2}),s=C.createColors(A,v));u=I.round(u)}else u=(g=g?L(a,!0):null)?Aa(g[0],g[1],5):R(a),x=[0,2,4],s=C.createColors(A,v);D.normalizationType=d;D.normalizationField=e;d=[{type:"colorInfo",field:r,normalizationField:e,stops:E.createColorStops({values:u,colors:s,labelIndexes:x})}];b&&b.widthInfo&&d.push(b.widthInfo);D.setVisualVariables(d);h.resolve({renderer:D,statistics:a,classBreaks:c,scheme:K(f,k)})}}else m(h,"smartMapping.createColorRenderer: unable to find the specified scheme.")}}function ca(a,
c,b,d){var e=null==b.useDefaultStatistics?!0:b.useDefaultStatistics;if(a&&!a.count&&!e)m(d,"smartMapping.createOpacityInfo: cannot create opacityInfo when statistics.count is 0.");else{var f=b.useStdDev,h=f?R(a):null,f=(e=e?L(a,f):null)||(f?[h[0],h[4]]:[a.min,a.max]);d.resolve({opacityInfo:{type:"opacityInfo",field:b.field,normalizationField:c,stops:[{value:f[0],opacity:0.3},{value:f[1],opacity:0.7}]},statistics:a,defaultStatistics:!!e})}}function N(a,c){var b=a.scheme;b=b?W.cloneScheme(b):(b=W.getSchemes({theme:a.theme||
Ba,basemap:a.basemap,geometryType:c}))&&b.primaryScheme;return b}function da(a,c){var b;switch(c){case "point":b=[a.minSize,a.maxSize];break;case "line":b=[a.minWidth,a.maxWidth];break;case "polygon":b=[a.marker.minSize,a.marker.maxSize]}return b}function ea(a,c,b,d,e,f,h){var g=null==f.useDefaultStatistics?!0:f.useDefaultStatistics,r=c&&[c.minSize,c.maxSize];if(a&&!a.count&&!g)m(h,"smartMapping.createSizeRenderer: cannot create renderer when statistics.count is 0.");else{var k=f.field,q=F(f.layer),
p=null==f.showOthers?!0:f.showOthers,n=N(f,q),r=r||da(n,q),x="polygon"===q,u=x?n.marker:n,n=x?n.background:null,s="line"===q?u.noDataWidth:u.noDataSize,t=f.useStdDev,l=t?R(a):null,l=(g=g?L(a,t):null)||(t?[l[0],l[4]]:[a.min,a.max]),t=new J(null,k);p&&(t.defaultSymbol=w(u,u.noDataColor,x?"point":q,s),t.defaultLabel=G.other);t.addBreak({minValue:-M,maxValue:M,symbol:w(u,u.color,x?"point":q)});n&&(t.backgroundFillSymbol=w(n,n.color,q));t.normalizationType=d;t.normalizationField=e;d=[{type:"sizeInfo",
field:k,valueUnit:"unknown",normalizationField:e,minSize:r[0],maxSize:r[1],minDataValue:l[0],maxDataValue:l[1]}];b&&b.widthInfo&&d.push(b.widthInfo);t.setVisualVariables(d);h.resolve({renderer:t,statistics:a,defaultStatistics:!!g,suggestedSizeRange:c,scheme:N(f,q)})}}function O(a,c,b){var d,e=[],f=1/(b+1);for(d=1;d<=b;d++)e.push(l.blendColors(a,c,f*d));return e}function fa(a,c){var b=[];if(1===c)b=[a[0]];else if(2===c)b=[a[0],a[2]];else if(3===c)b=a;else{var d=c-a.length,b=d/2;0===d%2?(d=O(a[0],a[1],
b),b=O(a[1],a[2],b)):(d=O(a[0],a[1],Math.floor(b)),b=O(a[1],a[2],Math.ceil(b)));b=[a[0]].concat(d).concat([a[1]]).concat(b).concat([a[2]])}return b}function ba(a,c,b){var d,e=c.length,f=-1;b&&y.some(c,function(a,c){a.hasAvg&&(f=c);return-1<f});if(-1<f){var h=a.colors;a=f+1;c=e-f;b=h.slice(0,3);h=h.slice(2);b.reverse();b=fa(b,a);h=fa(h,c);b.reverse();d=[].concat(b).concat(h.slice(1))}else if((a=a.colorsForClassBreaks)&&0<a.length)if(y.some(a,function(a){a.numClasses===e&&(d=a.colors);return!!d}),!d&&
(b=a[a.length-1],a=e-b.numClasses,0<a)){c=b.colors[b.numClasses-1];d=b.colors.splice(0);for(b=1;b<=a;b++)d.push(c)}d&&(d=C.createColors(d,d.length));return d}function Ca(a,c,b,d){var e=b.field,f=F(b.layer),h=null==b.showOthers?!0:b.showOthers,g=b.classificationMethod||"equal-interval",r="standard-deviation"===g,k=b.normalizationType,q,p,n,l=a.classBreakInfos;(q=K(b,f,"high-to-low"))?(p=ba(q,l),!p||p.length!=l.length?m(d,"smartMapping.createClassedColorRenderer: unable to find suitable colors for number of classes."):
(n=new J(null,e),n.classificationMethod=g,n.normalizationType=k,n.normalizationField="field"===k?b.normalizationField:void 0,n.normalizationTotal="percent-of-total"===k?a.normalizationTotal:void 0,h&&(n.defaultSymbol=w(q,q.noDataColor,f),n.defaultLabel=G.other),y.forEach(l,function(a,c){n.addBreak({minValue:a.minValue,maxValue:a.maxValue,symbol:w(q,p[c],f),label:a.label})}),r||E.setLabelsForClassBreaks({classBreaks:n.infos,classificationMethod:g,normalizationType:k,round:!0}),c&&c.widthInfo&&n.setVisualVariables([c.widthInfo]),
a.renderer=n,a.scheme=K(b,f,"high-to-low"),d.resolve(a))):m(d,"smartMapping.createClassedColorRenderer: unable to find suitable style scheme.")}function ga(a){var c=new v,b=a.layer,d=null==a.useDefaultBreaks?!0:a.useDefaultBreaks,e=a.optimizeOutline,f=[b.statisticsPlugin.getClassBreaks(a)];e&&f.push(b.statisticsPlugin.getSuggestedOutline("object"===typeof e?e:null));(new H(f)).then(function(f){var g=f[0];f=f[1];var r=e&&f[0]?f[1]:null;if(g[0]||d&&!b.graphics.length){var g=g[1],k=d?L(g?{min:g.minValue,
max:g.maxValue}:{}):null;k&&(g=a.layer.statisticsPlugin.getClassBreaks(z.mixin(a,{classificationMethod:"equal-interval",numClasses:1,analyzeData:!1,minValue:k[0],maxValue:k[1],normalizationTotal:k[0]+k[1]})));ma(g).then(function(a){a.defaultStatistics=!!k;c.resolve({cbResponse:a,suggestedOutline:r})}).otherwise(function(){m(c,"smartMapping: error when calculating default class breaks.")})}else m(c,"smartMapping: error when calculating class breaks.")});return c.promise}function Da(a,c,b,d){c=d||da(a,
c);a=c[0];c=(c[1]-a)/(4<=b?b-1:b);var e=[];for(d=0;d<b;d++)e.push(a+c*d);return e}function S(a,c,b,d,e){var f=d.field,h=F(d.layer),g=null==d.showOthers?!0:d.showOthers,r=d.classificationMethod||"equal-interval",k=d.normalizationType,q=a.classBreakInfos,p=N(d,h),n=Da(p,h,q.length,c),m="polygon"===h,l=m?p.marker:p;c=m?p.background:null;var s;s=new J(null,f);s.classificationMethod=r;s.normalizationType=k;s.normalizationField="field"===k?d.normalizationField:void 0;s.normalizationTotal="percent-of-total"===
k?a.normalizationTotal:void 0;g&&(s.defaultSymbol=w(l,l.noDataColor,m?"point":h),s.defaultLabel=G.other);c&&(s.backgroundFillSymbol=w(c,c.color,h));y.forEach(q,function(a,c){s.addBreak({minValue:a.minValue,maxValue:a.maxValue,symbol:w(l,l.color,m?"point":h,n[c]),label:a.label})});"standard-deviation"!==r&&E.setLabelsForClassBreaks({classBreaks:s.infos,classificationMethod:r,normalizationType:k,round:!0});b&&b.widthInfo&&s.setVisualVariables([b.widthInfo]);a.renderer=s;a.scheme=N(d,h);e.resolve(a)}
function T(a){var c=a.scheme;c=c?Y.cloneScheme(c):(c=Y.getSchemes({theme:a.theme||Ea,basemap:a.basemap}))&&c.primaryScheme;return c}function ha(a,c,b){var d=null==c.useDefaultStatistics?!0:c.useDefaultStatistics;if(!a.count&&!d)m(b,"smartMapping.createHeatmapRenderer: cannot create renderer when statistics.count is 0.");else{var e=a.fieldOffset,f=null==c.blurRadius?10:c.blurRadius,h=null==c.minRatio?0.01:c.minRatio,g=null==c.maxRatio?1:c.maxRatio,r=null==c.fadeToTransparent?!0:c.fadeToTransparent,
k=T(c).colors,q=k.length,p=(d=!a.count&&d)?[0,100]:[a.min,a.max],n=new ra;n.setBlurRadius(f);n.setField(c.field);null!=e&&n.setFieldOffset(e);n.setMinPixelIntensity(p[0]);n.setMaxPixelIntensity(p[1]);var e=k[0],x=[{ratio:0,color:new l([e.r,e.g,e.b,0])},{ratio:ia,color:new l([e.r,e.g,e.b,0])},{ratio:r?h:ia,color:e}],u=(g-h)/(q-1),k=C.createColors(k,q);y.forEach(k,function(a,c){x.push({ratio:h+u*c,color:a})});n.setColorStops(x);b.resolve({renderer:n,statistics:a,defaultStatistics:d,scheme:T(c)})}}var C=
{},M=Math.pow(2,53)-1,G=ta.smartMapping,ua="default",za="high-to-low",Ba="default",Ea="default",ia=0.01,A=U.toAbsMid?U.toAbsMid("../plugins/FeatureLayerStatistics"):ja.id.replace(/\/[^\/]*$/ig,"/")+"../plugins/FeatureLayerStatistics";z.mixin(C,{createColors:function(a,c){var b=[],d=a.length,e;for(e=0;e<c;e++)b.push(new l(a[e%d]));return b},createTypeRenderer:function(a){var c=new v;if(!a||!a.layer||!a.field||!a.scheme&&!a.basemap)return m(c,"smartMapping.createTypeRenderer: missing parameters."),
c.promise;var b=a.layer,d=a.optimizeOutline;b.addPlugin(A).then(function(){var e=[b.statisticsPlugin.getUniqueValues({field:a.field,includeAllCodedValues:a.includeAllCodedValues})];d&&e.push(b.statisticsPlugin.getSuggestedOutline("object"===typeof d?d:null));(new H(e)).then(function(b){var e=b[0];b=b[1];b=d&&b[0]?b[1]:null;e[0]?ya(e[1],b,a,c):m(c,"smartMapping.createTypeRenderer: error when calculating unique values.")})}).otherwise(function(a){m(c,"smartMapping.createTypeRenderer: error when adding feature layer statistics plugin.")});
return c.promise},createColorRenderer:function(a){var c=new v;if(!a||!a.layer||!a.field)return m(c,"smartMapping.createColorRenderer: missing parameters."),c.promise;var b=a.layer,d=a.normalizationField,e=d?"field":void 0,f=a.optimizeOutline;a.statistics?aa(a.statistics,null,null,e,d,a,c):b.addPlugin(A).then(function(){var h="group-similar"===a.theme||a.scheme&&0===a.scheme.id.indexOf("group-similar/"),g=[h?b.statisticsPlugin.getClassBreaks({field:a.field,classificationMethod:"natural-breaks",numClasses:a.numGroups||
5,normalizationType:e,normalizationField:d,minValue:a.minValue,maxValue:a.maxValue}):b.statisticsPlugin.getFieldStatistics({field:a.field,normalizationType:e,normalizationField:d,minValue:a.minValue,maxValue:a.maxValue})];f&&g.push(b.statisticsPlugin.getSuggestedOutline("object"===typeof f?f:null));(new H(g)).then(function(b){var g=b[0],q,p;b=b[1];b=f&&b[0]?b[1]:null;g[0]?(h?q=g[1]:p=g[1],aa(p,q,b,e,d,a,c)):m(c,h?"smartMapping.createColorRenderer: error when calculating class breaks.":"smartMapping.createColorRenderer: error when calculating field statistics.")})}).otherwise(function(a){m(c,
"smartMapping.createColorRenderer: error when adding feature layer statistics plugin.")});return c.promise},createOpacityInfo:function(a){var c=new v;if(!a||!a.layer||!a.field)return m(c,"smartMapping.createOpacityInfo: missing parameters."),c.promise;var b=a.layer,d=a.normalizationField,e=d?"field":void 0;a.statistics?ca(a.statistics,d,a,c):b.addPlugin(A).then(function(){b.statisticsPlugin.getFieldStatistics({field:a.field,normalizationType:e,normalizationField:d,minValue:a.minValue,maxValue:a.maxValue}).then(function(b){ca(b,
d,a,c)}).otherwise(function(a){m(c,"smartMapping.createOpacityInfo: error when calculating field statistics.")})}).otherwise(function(a){m(c,"smartMapping.createOpacityInfo: error when adding feature layer statistics plugin.")});return c.promise},createBlendRenderer:function(a){var c=new v,b=this,d,e=[],f={},h=[],g=[],r=a.opacityValueCombinationMethod||"avg",k={};if(!a||!a.layer||!a.blendedFields)return m(c,"smartMapping.createBlendRenderer: missing parameters."),c.promise;a.basemap=a.basemap||"topo";
e=F(a.layer);d=Q({basemap:a.basemap},e);d.colors=[new l("#e60000"),new l("#0000e6"),new l("#00e600"),new l("#e67300"),new l("#a900e6")];k.fields=[];k.normalizationField=a.normalizationField;k.blendMode=a.blendMode||"source-over";k.symbol=w(d,d.noDataColor,a.markers?"point":e);f.layer=a.layer;f.normalizationField=a.normalizationField;f.useStdDev=a.useStdDev||!1;e=y.map(a.blendedFields,function(a,c){k.fields.push({field:a,color:d.colors[c]});f.field=a;return b.createOpacityInfo(f)});la(e).then(function(b){g[0]=
b[0].opacityInfo.stops[0].value;g[1]=b[1].opacityInfo.stops[1].value;y.forEach(b.slice(0,1),function(a){var c=a.opacityInfo.stops[0].value,b=a.opacityInfo.stops[1].value;"union"===r?(g[0]=c<g[0]?c:g[0],g[1]=b>g[1]?b:g[1]):"avg"===r&&(g[0]+=a.opacityInfo.stops[0].value,g[1]+=a.opacityInfo.stops[1].value)});h[0]={value:"avg"===r?g[0]/b.length:g[0],opacity:a.minOpacity?a.minOpacity:b[0].opacityInfo.stops[0].opacity};h[1]={value:"avg"===r?g[1]/b.length:g[1],opacity:a.maxOpacity?a.maxOpacity:b[0].opacityInfo.stops[1].opacity};
k.opacityStops=h;c.resolve({renderer:new sa(k),scheme:d,opacityInfos:b})});return c.promise},createSizeRenderer:function(a){var c=new v;if(!a||!a.layer||!a.field)return m(c,"smartMapping.createSizeRenderer: missing parameters."),c.promise;var b=a.layer,d=a.normalizationField,e=d?"field":void 0,f=a.optimizeForScale,h=a.optimizeOutline;a.statistics?ea(a.statistics,null,null,e,d,a,c):b.addPlugin(A).then(function(){var g=[b.statisticsPlugin.getFieldStatistics({field:a.field,normalizationType:e,normalizationField:d,
minValue:a.minValue,maxValue:a.maxValue})];f&&g.push(b.statisticsPlugin.getSuggestedSizeRange({optimizeForScale:!0===f?"map-scale":f}));h&&g.push(b.statisticsPlugin.getSuggestedOutline("object"===typeof h?h:null));(new H(g)).then(function(b){var g=b[0],l=f&&b[1],l=f&&l[0]?l[1]:null;b=f?b[2]:b[1];b=h&&b[0]?b[1]:null;g[0]?ea(g[1],l,b,e,d,a,c):m(c,"smartMapping.createSizeRenderer: error when calculating field statistics.")})}).otherwise(function(a){m(c,"smartMapping.createSizeRenderer: error when adding feature layer statistics plugin.")});
return c.promise},createClassedColorRenderer:function(a){var c=new v,b=a.minValue,d=a.maxValue,e;if(!a||!a.layer||!a.field)return m(c,"smartMapping.createClassedColorRenderer: missing parameters."),c.promise;e=null!=b&&null!=d;if(!e&&(null!=b||null!=d))return m(c,"smartMapping.createClassedColorRenderer: both minValue and maxValue are required when specifying custom data range."),c.promise;a=z.mixin({analyzeData:!e},a);a.layer.addPlugin(A).then(function(){ga(a).then(function(b){Ca(b.cbResponse,b.suggestedOutline,
a,c)}).otherwise(function(a){m(c,"smartMapping.createClassedColorRenderer: error when calculating class breaks.")})}).otherwise(function(a){m(c,"smartMapping.createClassedColorRenderer: error when adding feature layer statistics plugin.")});return c.promise},createClassedSizeRenderer:function(a){var c=new v,b=a.minValue,d=a.maxValue,e;if(!a||!a.layer||!a.field)return m(c,"smartMapping.createClassedSizeRenderer: missing parameters."),c.promise;e=null!=b&&null!=d;if(!e&&(null!=b||null!=d))return m(c,
"smartMapping.createClassedColorRenderer: both minValue and maxValue are required when specifying custom data range."),c.promise;a=z.mixin({analyzeData:!e},a);var f=a.layer;f.addPlugin(A).then(function(){ga(a).then(function(b){a.optimizeForScale?f.statisticsPlugin.getSuggestedSizeRange().then(function(d){S(b.cbResponse,[d.minSize,d.maxSize],b.suggestedOutline,a,c)}).otherwise(function(d){S(b.cbResponse,null,b.suggestedOutline,a,c)}):S(b.cbResponse,null,b.suggestedOutline,a,c)}).otherwise(function(a){m(c,
"smartMapping.createClassedSizeRenderer: error when calculating class breaks.")})}).otherwise(function(a){m(c,"smartMapping.createClassedSizeRenderer: error when adding feature layer statistics plugin.")});return c.promise},createHeatmapRenderer:function(a){var c=new v;if(!a||!a.layer)return m(c,"smartMapping.createHeatmapRenderer: missing parameters."),c.promise;var b=a.layer;a.statistics?ha(a.statistics,a,c):b.addPlugin(A).then(function(){b.statisticsPlugin.getHeatmapStatistics(a).then(function(b){ha(b,
a,c)}).otherwise(function(a){m(c,"smartMapping.createHeatmapRenderer: error when calculating heatmap statistics.")})}).otherwise(function(a){m(c,"smartMapping.createHeatmapRenderer: error when adding feature layer statistics plugin.")});return c.promise},applyHeatmapScheme:function(a){if(!a||!a.renderer||!a.scheme)console.log("smartMapping.applyHeatmapScheme: missing parameters.");else{var c=T({scheme:a.scheme});a=a.renderer;var b=a.colorStops,c=c.colors;if(b.length!==c.length+3)console.log("smartMapping.applyHeatmapScheme: incompatible number of colors in 'colors' and 'renderer.colorStops'.");
else{var d;d=new l(c[0]);b=y.map(b,function(a){return z.mixin({},a)});b[0].color=new l([d.r,d.g,d.b,0]);b[1].color=new l([d.r,d.g,d.b,0]);b[2].color=d;for(d=3;d<b.length;d++)b[d].color=c[d-3];a.setColorStops(b)}}}});ka("extend-esri")&&z.setObject("renderer.smartMapping",C,na);return C});