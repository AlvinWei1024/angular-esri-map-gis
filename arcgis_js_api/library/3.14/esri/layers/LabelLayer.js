// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See http://js.arcgis.com/3.14/esri/copyright.txt for details.
//>>built
require({cache:{"esri/layers/labelLayerUtils/DynamicLabelClass":function(){define("dojo/_base/declare dojo/_base/lang dojo/has ../../kernel ../GraphicsLayer ../../geometry/Extent ../../geometry/Polygon".split(" "),function(B,G,A,H,E,C,D){B=B(E,{declaredClass:"esri.layers.labelLayerUtils.DynamicLabelClass",constructor:function(){this._preparedLabels=[];this._placedLabels=[];this._extent=null;this._y1=this._x1=this._y0=this._x0=this._ymax=this._ymin=this._xmax=this._xmin=0;this._scale=1},setMap:function(h,
b){this._labelLayer=b;this._xmin=h.extent.xmin;this._xmax=h.extent.xmax;this._ymin=h.extent.ymin;this._ymax=h.extent.ymax;this._scale=(this._xmax-this._xmin)/h.width},_process:function(h){this._preparedLabels=h;this._placedLabels=[];var b;for(h=this._preparedLabels.length-1;0<=h;h--){var a=this._preparedLabels[h],d=Math.min(a.labelWidth,a.labelHeight),g=a.labelWidth+0*d,d=a.labelHeight+0*d,f=(b=a.options)&&void 0!==b.lineLabelPlacement?b.lineLabelPlacement:"PlaceAtCenter",c=b&&void 0!==b.lineLabelPosition?
b.lineLabelPosition:"Above",e=b&&void 0!==b.pointPriorities?b.pointPriorities:"AboveRight",k=[2,2,1,3,0,2,3,3,2];"AboveLeft"==e?k=[1,2,2,2,0,3,2,3,3]:"AboveCenter"==e?k=[2,1,2,2,0,2,3,3,3]:"AboveRight"==e?k=[2,2,1,3,0,2,3,3,2]:"CenterLeft"==e?k=[2,2,3,1,0,3,2,2,3]:"CenterCenter"==e?k=[0,0,0,0,1,0,0,0,0]:"CenterRight"==e?k=[3,2,2,3,0,1,3,2,2]:"BelowLeft"==e?k=[2,3,3,2,0,3,1,2,2]:"BelowCenter"==e?k=[3,3,3,2,0,2,2,1,2]:"BelowRight"==e&&(k=[3,3,2,3,0,2,2,2,1]);var m=b&&void 0!==b.labelRotation?b.labelRotation:
!0,e=a.angle*(Math.PI/180);b=b&&void 0!==b.howManyLabels?b.howManyLabels:"OneLabel";if("point"==a.geometry.type)this._generatePointPositions(a,a.geometry.x,a.geometry.y,a.text,e,g,d,a.symbolWidth,a.symbolHeight,k);else if("multipoint"==a.geometry.type){f=a.geometry;for(c=0;c<f.points.length;c++)this._generatePointPositions(a,f.points[c][0],f.points[c][1],a.text,e,g,d,a.symbolWidth,a.symbolHeight,k)}else"polyline"==a.geometry.type?this._generateLinePositions(a,a.geometry,a.text,g,d,2*a.symbolHeight+
d,f,c,m):"polygon"==a.geometry.type&&this._generatePolygonPositions(a,b,a.geometry,a.text,e,g,d)}return this._placedLabels},_generatePointPositions:function(h,b,a,d,g,f,c,e,k,m){e=(e+f)*this._scale;k=(k+c)*this._scale;var s,n;for(s=1;3>=s;s++)for(n=1;9>=n;n++)if(m[n-1]==s)switch(n){case 1:if(this._findPlace(h,d,b-e,a+k,g,f,c))return;break;case 2:if(this._findPlace(h,d,b,a+k,g,f,c))return;break;case 3:if(this._findPlace(h,d,b+e,a+k,g,f,c))return;break;case 4:if(this._findPlace(h,d,b-e,a,g,f,c))return;
break;case 5:if(this._findPlace(h,d,b,a,g,f,c))return;break;case 6:if(this._findPlace(h,d,b+e,a,g,f,c))return;break;case 7:if(this._findPlace(h,d,b-e,a-k,g,f,c))return;break;case 8:if(this._findPlace(h,d,b,a-k,g,f,c))return;break;case 9:if(this._findPlace(h,d,b+e,a-k,g,f,c))return}},_generateLinePositions:function(h,b,a,d,g,f,c,e,k){var m=d*this._scale*d*this._scale,s,n,l;for(s=0;s<b.paths.length;s++){var p=b.paths[s],r=p.length,q=Math.floor((r-1)/2),u=0!==(r-1)%2?1:-1;"PlaceAtStart"==c&&(q=0,u=1);
"PlaceAtEnd"==c&&(q=r-2,u=-1);for(;0<=q&&q<r-1;){for(n=q;n<r;n++){var v=p[q][0],t=p[q][1],w=p[n][0]-v,x=p[n][1]-t;if(w*w+x*x>m){for(var z=Math.atan2(x,w);z>Math.PI/2;)z-=Math.PI;for(;z<-(Math.PI/2);)z+=Math.PI;var y=Math.sin(z),F=Math.cos(z),I=0,J=0;"Above"==e&&(I=f*y*this._scale,J=f*F*this._scale);"Below"==e&&(I=-f*y*this._scale,J=-f*F*this._scale);if(1==n-q){if(this._clipLine(v,t,p[n][0],p[n][1])&&(v=this._x1-this._x0,l=this._y1-this._y0,v*v+l*l>m&&(n=Math.atan2(l,v),w=d/2+2*g,t=w*this._scale*Math.cos(n),
w=w*this._scale*Math.sin(n),"PlaceAtStart"==c?(v=this._x0+t,l=this._y0+w):"PlaceAtEnd"==c?(v=this._x1-t,l=this._y1-w):(v=this._x0+v/2,l=this._y0+l/2),this._findPlace(h,a,v-I,l+J,k?-n:0,d,g))))return}else{var K=0;for(l=q;l<=n;l++)K=Math.max(K,Math.abs((p[l][1]-t)*F-(p[l][0]-v)*y));if(K<g&&this._findPlace(h,a,v+w/2-I,t+x/2+J,k?-z:0,d,g))return}break}}q+=u}}},_generatePolygonPositions:function(h,b,a,d,g,f,c){var e;if("ManyLabels"==b)for(b=0;b<a.rings.length;b++)e=a.rings[b],D.prototype.isClockwise(e)&&
(e=this._findCentroid(e,this._xmin,this._ymin,this._xmax,this._ymax),this._findPlace(h,d,e[0],e[1],g,f,c));else{e=this._findCentroidForFeature(a,this._xmin,this._ymin,this._xmax,this._ymax);var k=e[1],m=0;for(b=0;10>b;b++){m+=c/4;e=this._findCentroidForFeature(a,this._xmin,k+(m-c/4),this._xmax,k+(m+c/4));if(this._findPlace(h,d,e[0],e[1],g,f,c))break;e=this._findCentroidForFeature(a,this._xmin,k-(m+c/4),this._xmax,k-(m-c/4));if(this._findPlace(h,d,e[0],e[1],g,f,c))break}}},_findCentroid:function(h,
b,a,d,g){var f=h.length,c=[0,0],e=0,k=h[0][0],m=h[0][1];k>d&&(k=d);k<b&&(k=b);m>g&&(m=g);m<a&&(m=a);for(var s=1;s<f-1;s++){var n=h[s][0],l=h[s][1],p=h[s+1][0],r=h[s+1][1];n>d&&(n=d);n<b&&(n=b);l>g&&(l=g);l<a&&(l=a);p>d&&(p=d);p<b&&(p=b);r>g&&(r=g);r<a&&(r=a);var q=(n-k)*(r-m)-(p-k)*(l-m);c[0]+=q*(k+n+p);c[1]+=q*(m+l+r);e+=q}c[0]/=3*e;c[1]/=3*e;if(isNaN(c[0])||isNaN(c[1]))return c;a=[];this._fillBuffer(h,a,c);c[0]=this._sortBuffer(a,c[0],b,d);return c},_findCentroidForFeature:function(h,b,a,d,g){for(var f,
c=0,e=[0,0],k=0;k<h.rings.length;k++){var m=h.rings[k],s=m.length,n=m[0][0],l=m[0][1];n>d&&(n=d);n<b&&(n=b);l>g&&(l=g);l<a&&(l=a);for(f=1;f<s-1;f++){var p=m[f][0],r=m[f][1],q=m[f+1][0],u=m[f+1][1];p>d&&(p=d);p<b&&(p=b);r>g&&(r=g);r<a&&(r=a);q>d&&(q=d);q<b&&(q=b);u>g&&(u=g);u<a&&(u=a);var v=(p-n)*(u-l)-(q-n)*(r-l);e[0]+=v*(n+p+q);e[1]+=v*(l+r+u);c+=v}}e[0]/=3*c;e[1]/=3*c;if(isNaN(e[0])||isNaN(e[1]))return e;a=[];for(f=0;f<h.rings.length;f++)this._fillBuffer(h.rings[f],a,e);e[0]=this._sortBuffer(a,
e[0],b,d);return e},_fillBuffer:function(h,b,a){for(var d=h.length-1,g=h[0][1]>=h[d][1]?1:-1,f=0;f<=d;f++){var c=f,e=f+1;f==d&&(e=0);var k=h[c][0],c=h[c][1],m=h[e][0],e=h[e][1],s=e>=c?1:-1;if(c<=a[1]&&a[1]<=e||e<=a[1]&&a[1]<=c)a[1]!=c&&a[1]!=e?(b.push((a[1]-c)*(m-k)/(e-c)+k),g=s):a[1]==c&&a[1]!=e?(g!=s&&b.push(k),g=s):a[1]!=c&&a[1]==e?(b.push(m),g=s):a[1]==c&&a[1]==e&&(1==g&&b.push(k),b.push(m),g=s)}},_sortBuffer:function(h,b,a,d){var g=h.length;h.sort();if(0<g){for(var f=0,c=b=0;c<g-1;c+=2){var e=
Math.abs(h[c+1]-h[c]);!(h[c]<=a&&h[c+1]<=a)&&(!(h[c]>=d&&h[c+1]>=d)&&e>f)&&(f=e,b=c)}g=h[b];h=h[b+1];g>d&&(g=d);g<a&&(g=a);h>d&&(h=d);h<a&&(h=a);b=(g+h)/2}return b},_findPlace:function(h,b,a,d,g,f,c){if(isNaN(a)||isNaN(d))return!1;for(var e=0;e<this._placedLabels.length;e++){var k=this._placedLabels[e].angle,m=this._placedLabels[e].width*this._scale,s=this._placedLabels[e].height*this._scale,n=this._placedLabels[e].x-a,l=this._placedLabels[e].y-d;if(0===g&&0===k){if(this._findPlace2(-f*this._scale,
-c*this._scale,f*this._scale,c*this._scale,n-m,l-s,n+m,l+s))return!1}else{var p=new C(-f*this._scale,-c*this._scale,f*this._scale,c*this._scale,null),r=0,q=1;0!==g&&(r=Math.sin(g),q=Math.cos(g));var u=n*q-l*r,n=n*r+l*q,k=k-g,r=Math.sin(k),q=Math.cos(k),v=-m*q- -s*r,l=-m*r+-s*q,k=+m*q- -s*r,t=+m*r+-s*q,m=u+v,s=n-l,r=u+k,q=n-t,v=u-v,l=n+l,u=u-k,n=n+t,k=new D;k.addRing([[m,s],[r,q],[v,l],[u,n],[m,s]]);if(p.intersects(k))return!1}}for(;g>Math.PI/2;)g-=Math.PI;for(;g<-(Math.PI/2);)g+=Math.PI;e={};e.layer=
h;e.text=b;e.angle=g;e.x=a;e.y=d;e.width=f;e.height=c;this._placedLabels.push(e);return!0},_findPlace2:function(h,b,a,d,g,f,c,e){return(h>=g&&h<=c||a>=g&&a<=c||h<=g&&a>=c)&&(b>=f&&b<=e||d>=f&&d<=e||b<=f&&d>=e)?!0:!1},_clipLine:function(h,b,a,d){for(var g=this._code(h,b),f=this._code(a,d);0!==g||0!==f;){if(0!==(g&f))return!1;var c=a-h,e=d-b;0!==g?(h<this._xmin?(b+=e*(this._xmin-h)/c,h=this._xmin):h>this._xmax?(b+=e*(this._xmax-h)/c,h=this._xmax):b<this._ymin?(h+=c*(this._ymin-b)/e,b=this._ymin):b>
this._ymax&&(h+=c*(this._ymax-b)/e,b=this._ymax),g=this._code(h,b)):(a<this._xmin?(d+=e*(this._xmin-a)/c,a=this._xmin):a>this._xmax?(d+=e*(this._xmax-a)/c,a=this._xmax):d<this._ymin?(a+=c*(this._ymin-d)/e,d=this._ymin):d>this._ymax&&(a+=c*(this._ymax-d)/e,d=this._ymax),f=this._code(a,d))}this._x0=h;this._y0=b;this._x1=a;this._y1=d;return!0},_code:function(h,b){var a=0;h<this._xmin&&(a+=8);h>this._xmax&&(a+=4);b<this._ymin&&(a+=2);b>this._ymax&&(a+=1);return a}});A("extend-esri")&&G.setObject("layers.labelLayerUtils.DynamicLabelClass",
B,H);return B})},"esri/layers/labelLayerUtils/StaticLabelClass":function(){define("dojo/_base/declare dojo/_base/lang dojo/has ../../kernel ../GraphicsLayer ../../geometry/Extent ../../geometry/Point ../../geometry/Polygon".split(" "),function(B,G,A,H,E,C,D,h){return B(E,{declaredClass:"esri.layers.labelLayerUtils.StaticLabel",constructor:function(){this._preparedLabels=[];this._placedLabels=[];this._extent=null;this._ymax=this._ymin=this._xmax=this._xmin=0;this._scale=1;this._LINE_STEP_CONST=1.5;
this._POLYGON_X_STEP_CONST=1;this._POLYGON_Y_STEP_CONST=0.75;this._OVERRUN=2},setMap:function(b,a){this._labelLayer=a;this._map=b;this._xmin=b.extent.xmin;this._xmax=b.extent.xmax;this._ymin=b.extent.ymin;this._ymax=b.extent.ymax;this._scale=(this._xmax-this._xmin)/b.width},_process:function(b){var a,d,g,f,c,e,k,m,s;this._preparedLabels=b;this._placedLabels=[];for(b=this._preparedLabels.length-1;0<=b;b--){a=this._preparedLabels[b];c=a.labelWidth;e=a.labelHeight;m=(k=a.options)&&k.lineLabelPlacement?
k.lineLabelPlacement:"PlaceAtCenter";s=k&&k.lineLabelPosition?k.lineLabelPosition:"Above";d=k&&k.labelRotation?k.labelRotation:!0;g=a.angle*(Math.PI/180);f=k&&k.howManyLabels?k.howManyLabels:"OneLabel";var n=[];if("point"===a.geometry.type)this._generatePointPositions(a.geometry.x,a.geometry.y,a.text,g,c,e,a.symbolWidth,a.symbolHeight,k,n);else if("multipoint"===a.geometry.type)for(d=0;d<a.geometry.points.length;d++)this._generatePointPositions(a.geometry.points[d][0],a.geometry.points[d][1],a.text,
g,c,e,a.symbolWidth,a.symbolHeight,k,n);else if("polyline"===a.geometry.type)if("PlaceAtStart"===m)this._generateLinePositionsPlaceAtStart(a.geometry,!0,a.text,c,e,2*a.symbolHeight+e,m,s,d,n);else if("PlaceAtEnd"===m)this._generateLinePositionsPlaceAtEnd(a.geometry,!0,a.text,c,e,2*a.symbolHeight+e,m,s,d,n);else{k=[];var l=a.geometry.getExtent(),p=this._map.extent;if(l.getWidth()<c*this._scale/this._OVERRUN&&l.getHeight()<c*this._scale/this._OVERRUN)continue;else 0.5*l.getWidth()<p.getWidth()&&0.5*
l.getHeight()<p.getHeight()?(p=0.1*Math.min(this._map.width,this._map.height)*this._scale,this._generateLinePositionsPlaceAtCenter(a.geometry,!1,p,a.text,c,e,2*a.symbolHeight+e,m,s,d,k)):(p=this._LINE_STEP_CONST*Math.min(this._map.width,this._map.height)*this._scale,this._generateLinePositionsPlaceAtCenter(a.geometry,!0,p,a.text,c,e,2*a.symbolHeight+e,m,s,d,k));this._postSorting(l,k,n)}else if("polygon"===a.geometry.type)for(d=0;d<a.geometry.rings.length;d++)m=a.geometry.rings[d],h.prototype.isClockwise(m)&&
(s=this._calcRingExtent(m),s.xmax-s.xmin<4*c*this._scale/this._OVERRUN&&s.ymax-s.ymin<4*e*this._scale/this._OVERRUN||this._generatePolygonPositionsForManyLabels(m,a.geometry.spatialReference,a.text,g,c,e,n));for(d=0;d<n.length&&!(m=n[d].x,s=n[d].y,void 0!==n[d].angle&&(g=n[d].angle),k=this._findPlace(a,a.text,m,s,g,c,e),"OneLabel"===f&&k&&this._labelLayer._isWithinScreenArea(new D(m,s,a.geometry.spatialReference)));d++);}return this._placedLabels},_generatePointPositions:function(b,a,d,g,f,c,e,k,
m,h){d=m&&m.pointPriorities?m.pointPriorities:"AboveRight";f=(e+f)*this._scale;c=(k+c)*this._scale;switch(d.toLowerCase()){case "aboveleft":b-=f;a+=c;break;case "abovecenter":a+=c;break;case "aboveright":b+=f;a+=c;break;case "centerleft":b-=f;break;case "centercenter":break;case "centerright":b+=f;break;case "belowleft":b-=f;a-=c;break;case "belowcenter":a-=c;break;case "belowright":b+=f;a-=c;break;default:return}h.push({x:b,y:a})},_generateLinePositionsPlaceAtStart:function(b,a,d,g,f,c,e,k,m,h){e=
g*this._scale;var n=this._LINE_STEP_CONST*Math.min(this._map.width,this._map.height)*this._scale,l,p,r,q,u,v,t,w;for(l=0;l<b.paths.length;l++){var x=b.paths[l],z=e,y=0;for(p=0;p<x.length-1;p++)r=x[p][0],q=x[p][1],u=x[p+1][0],v=x[p+1][1],t=u-r,w=v-q,t=Math.sqrt(t*t+w*w),y+t>z?(y=this._generatePositionsOnLine(b.spatialReference,a,z,n,y,r,q,u,v,d,g,f,c,k,m,h),z=n):y+=t}},_generateLinePositionsPlaceAtEnd:function(b,a,d,g,f,c,e,k,m,h){e=g*this._scale;var n=this._LINE_STEP_CONST*Math.min(this._map.width,
this._map.height)*this._scale,l,p,r,q,u,v,t,w;for(l=0;l<b.paths.length;l++){var x=b.paths[l],z=e,y=0;for(p=x.length-2;0<=p;p--)r=x[p+1][0],q=x[p+1][1],u=x[p][0],v=x[p][1],t=u-r,w=v-q,t=Math.sqrt(t*t+w*w),y+t>z?(y=this._generatePositionsOnLine(b.spatialReference,a,z,n,y,r,q,u,v,d,g,f,c,k,m,h),z=n):y+=t}},_generateLinePositionsPlaceAtCenter:function(b,a,d,g,f,c,e,k,m,h,n){var l,p,r,q,u,v,t,w;for(k=0;k<b.paths.length;k++){var x=b.paths[k];if(!(2>x.length)){var z=0;for(l=0;l<x.length-1;l++)r=x[l][0],
q=x[l][1],u=x[l+1][0],v=x[l+1][1],t=u-r,w=v-q,z+=Math.sqrt(t*t+w*w);var y=0;for(l=0;l<x.length-1;l++){r=x[l][0];q=x[l][1];u=x[l+1][0];v=x[l+1][1];t=u-r;w=v-q;t=Math.sqrt(t*t+w*w);if(y+t>z/2)break;y+=t}l==x.length-1&&l--;r=x[l][0];q=x[l][1];u=x[l+1][0];v=x[l+1][1];t=u-r;w=v-q;y=z/2-y;w=Math.atan2(w,t);t=r+y*Math.cos(w);w=q+y*Math.sin(w);r=this._angleAndShifts(r,q,u,v,e,m,h);n.push({x:t+r.shiftX,y:w+r.shiftY,angle:r.angle});var z=t,F=w,y=0;for(p=l;p<x.length-1;p++)p==l?(r=z,q=F):(r=x[p][0],q=x[p][1]),
u=x[p+1][0],v=x[p+1][1],t=u-r,w=v-q,t=Math.sqrt(t*t+w*w),y=y+t>d?this._generatePositionsOnLine(b.spatialReference,a,d,d,y,r,q,u,v,g,f,c,e,m,h,n):y+t;y=0;for(p=l;0<=p;p--)p==l?(r=z,q=F):(r=x[p+1][0],q=x[p+1][1]),u=x[p][0],v=x[p][1],t=u-r,w=v-q,t=Math.sqrt(t*t+w*w),y=y+t>d?this._generatePositionsOnLine(b.spatialReference,a,d,d,y,r,q,u,v,g,f,c,e,m,h,n):y+t}}},_generatePositionsOnLine:function(b,a,d,g,f,c,e,k,m,h,n,l,p,r,q,u){h=Math.atan2(m-e,k-c);n=c;l=e;var v=n,t=l;do if(f=d-f,n+=f*Math.cos(h),l+=f*
Math.sin(h),this._belongs(n,l,c,e,k,m))f=this._angleAndShifts(c,e,k,m,p,r,q),d=n+f.shiftX,t=l+f.shiftY,a?this._labelLayer._isWithinScreenArea(new C(d,t,d,t,b))&&u.push({x:d,y:t,angle:f.angle}):u.push({x:d,y:t,angle:f.angle}),v=n,t=l,f=0,d=g;else return b=k-v,m-=t,Math.sqrt(b*b+m*m);while(1)},_postSorting:function(b,a,d){if(b&&0<a.length){var g=0.5*(b.xmin+b.xmax);b=0.5*(b.ymin+b.ymax);for(var f=a[0].x,c=a[0].y,e=Math.sqrt((f-g)*(f-g)+(c-b)*(c-b)),k=a[0].angle,m=0;m<a.length;m++){var h=a[m].x,n=a[m].y,
l=Math.sqrt((h-g)*(h-g)+(n-b)*(n-b));l<e&&(f=h,c=n,e=l,k=a[m].angle)}d.push({x:f,y:c,angle:k})}},_belongs:function(b,a,d,g,f,c){if(f==d&&c==g)return!1;if(f>d){if(b>f||b<d)return!1}else if(b<f||b>d)return!1;if(c>g){if(a>c||a<g)return!1}else if(a<c||a>g)return!1;return!0},_angleAndShifts:function(b,a,d,g,f,c,e){for(b=Math.atan2(g-a,d-b);b>Math.PI/2;)b-=Math.PI;for(;b<-(Math.PI/2);)b+=Math.PI;g=Math.sin(b);var k=Math.cos(b);d=a=0;"Above"==c&&(a=f*g*this._scale,d=f*k*this._scale);"Below"==c&&(a=-f*g*
this._scale,d=-f*k*this._scale);f=[];f.angle=e?-b:0;f.shiftX=-a;f.shiftY=d;return f},_generatePolygonPositionsForManyLabels:function(b,a,d,g,f,c,e){g=this._calcRingExtent(b);if(0.75*(g.xmax-g.xmin)>this._map.width*this._scale||0.75*(g.ymax-g.ymin)>this._map.height*this._scale){var k=this._findCentroidForRing(b);c=this._map.width*this._scale<g.xmax-g.xmin?this._POLYGON_X_STEP_CONST*this._map.width*this._scale:this._POLYGON_X_STEP_CONST*(g.xmax-g.xmin);f=this._map.height*this._scale<g.ymax-g.ymin?this._POLYGON_Y_STEP_CONST*
this._map.height*this._scale:this._POLYGON_Y_STEP_CONST*(g.ymax-g.ymin);var m=k[0]-Math.round((k[0]-g.xmin)/c)*c,h=k[1]-Math.round((k[1]-g.ymin)/f)*f,n,k=!0;for(n=h;n<g.ymax;n+=f)if(k=!k,!(n<this._ymin||n>this._ymax))for(h=m+(k?0:c/2);h<g.xmax;h+=c)this._labelLayer._isWithinScreenArea(new C(h,n,h,n,a))&&this._isPointWithinRing(d,b,h,n)&&e.push({x:h,y:n})}else{k=this._findCentroidForRing(b);for(g=0;10>g;g++)if(f=k[0],m=k[1]+(g%2?-1:1)*Math.floor(g/2)*c*this._scale,this._labelLayer._isWithinScreenArea(new C(f,
m,f,m,a))&&this._isPointWithinRing(d,b,f,m)){e.push({x:f,y:m});break}}},_calcRingExtent:function(b){var a,d;d=new C;for(a=0;a<b.length-1;a++){var g=b[a][0],f=b[a][1];if(void 0===d.xmin||g<d.xmin)d.xmin=g;if(void 0===d.ymin||f<d.ymin)d.ymin=f;if(void 0===d.xmax||g>d.xmax)d.xmax=g;if(void 0===d.ymax||f>d.ymax)d.ymax=f}return d},_isPointWithinPolygon:function(b,a,d,g){var f;for(f=0;f<a.rings.length;f++)if(this._isPointWithinRing(b,a.rings[f],d,g))return!0;return!1},_isPointWithinRing:function(b,a,d,
g){var f,c,e,k,m=[],h=a.length;for(b=0;b<h-1;b++)if(f=a[b][0],c=a[b][1],e=a[b+1][0],k=a[b+1][1],!(f==e&&c==k)){if(c==k)if(g==c)m.push(f);else continue;f==e?(c<k&&(g>=c&&g<k)&&m.push(f),c>k&&(g<=c&&g>k)&&m.push(f)):(c=(e-f)/(k-c)*(g-c)+f,f<e&&(c>=f&&c<e)&&m.push(c),f>e&&(c<=f&&c>e)&&m.push(c))}m.sort(function(a,b){return a-b});for(b=0;b<m.length-1;b++)if(f=m[b],e=m[b+1],d>=f&&d<e)if(b%2)break;else return!0;return!1},_findCentroidForRing:function(b){for(var a=b.length,d=[0,0],g=0,f=b[0][0],c=b[0][1],
e=1;e<a-1;e++){var k=b[e][0],m=b[e][1],h=b[e+1][0],n=b[e+1][1],l=(k-f)*(n-c)-(h-f)*(m-c);d[0]+=l*(f+k+h);d[1]+=l*(c+m+n);g+=l}d[0]/=3*g;d[1]/=3*g;return d},_findCentroidForFeature:function(b){for(var a=0,d=[0,0],g=0;g<b.rings.length;g++)for(var f=b.rings[g],c=f.length,e=f[0][0],k=f[0][1],h=1;h<c-1;h++){var s=f[h][0],n=f[h][1],l=f[h+1][0],p=f[h+1][1],r=(s-e)*(p-k)-(l-e)*(n-k);d[0]+=r*(e+s+l);d[1]+=r*(k+n+p);a+=r}d[0]/=3*a;d[1]/=3*a;return d},_findPlace:function(b,a,d,g,f,c,e){if(isNaN(d)||isNaN(g))return!1;
for(var k=0;k<this._placedLabels.length;k++){var m=this._placedLabels[k].angle,s=this._placedLabels[k].width*this._scale,n=this._placedLabels[k].height*this._scale,l=this._placedLabels[k].x-d,p=this._placedLabels[k].y-g;if(0===f&&0===m){if(this._findPlace2(-c*this._scale,-e*this._scale,c*this._scale,e*this._scale,l-s,p-n,l+s,p+n))return!1}else{var r=new C(-c*this._scale,-e*this._scale,c*this._scale,e*this._scale,null),q=0,u=1;0!==f&&(q=Math.sin(f),u=Math.cos(f));var v=l*u-p*q,l=l*q+p*u,m=m-f,q=Math.sin(m),
u=Math.cos(m),t=-s*u- -n*q,p=-s*q+-n*u,m=+s*u- -n*q,w=+s*q+-n*u,s=v+t,n=l-p,q=v+m,u=l-w,t=v-t,p=l+p,v=v-m,l=l+w,m=new h;m.addRing([[s,n],[q,u],[t,p],[v,l],[s,n]]);if(r.intersects(m))return!1}}for(;f>Math.PI/2;)f-=Math.PI;for(;f<-(Math.PI/2);)f+=Math.PI;k={};k.layer=b;k.text=a;k.angle=f;k.x=d;k.y=g;k.width=c;k.height=e;this._placedLabels.push(k);return!0},_findPlace2:function(b,a,d,g,f,c,e,k){return(b>=f&&b<=e||d>=f&&d<=e||b<=f&&d>=e)&&(a>=c&&a<=k||g>=c&&g<=k||a<=c&&g>=k)?!0:!1}})})},"*noref":1}});
define("esri/layers/LabelLayer","require dojo/_base/declare dojo/_base/lang dojo/number dojo/i18n!dojo/cldr/nls/number dojo/_base/array dojo/_base/connect dojo/has dojox/gfx/_base ../kernel ../lang ../graphic ../PopupInfo ./labelLayerUtils/DynamicLabelClass ./labelLayerUtils/StaticLabelClass ../symbols/TextSymbol ../symbols/ShieldLabelSymbol ../geometry/Extent ../geometry/Point ../geometry/webMercatorUtils ./GraphicsLayer ./LabelClass ../renderers/SimpleRenderer".split(" "),function(B,G,A,H,E,C,D,
h,b,a,d,g,f,c,e,k,m,s,n,l,p,r,q){function u(a){return"sizeInfo"===a.type}B=G(p,{declaredClass:"esri.layers.LabelLayer",constructor:function(a){this.id="labels";this.featureLayers=[];this._featureLayerInfos=[];this._preparedLabels=[];this._engineType="STATIC";this._mapEventHandlers=[];a&&(a.id&&(this.id=a.id),a.mode&&(this._engineType="DYNAMIC"===a.mode.toUpperCase()?"DYNAMIC":"STATIC"))},_setMap:function(a){var b=this.inherited(arguments);this._map&&this._mapEventHandlers.push(this._map.on("extent-change",
A.hitch(this,"refresh")));this.refresh();return b},_unsetMap:function(){var a;for(a=0;a<this._mapEventHandlers.length;a++)D.disconnect(this._mapEventHandlers[a]);this.refresh();this.inherited(arguments)},setAlgorithmType:function(a){this._engineType=a&&"DYNAMIC"===a.toUpperCase()?"DYNAMIC":"STATIC";this.refresh()},addFeatureLayer:function(a,b,d,c){if(!this.getFeatureLayer(a.layerId)){var e=[];e.push(a.on("update-end",A.hitch(this,"refresh")));e.push(a.on("suspend",A.hitch(this,"refresh")));e.push(a.on("resume",
A.hitch(this,"refresh")));e.push(a.on("edits-complete",A.hitch(this,"refresh")));e.push(a.on("labeling-info-change",A.hitch(this,"refresh")));e.push(a.on("time-extent-change",A.hitch(this,"refresh")));e.push(a.on("show-labels-change",A.hitch(this,"refresh")));this._featureLayerInfos.push({FeatureLayer:a,LabelExpressionInfo:d,LabelingOptions:c,LabelRenderer:b,EventHandlers:e});this.featureLayers.push(a);this.refresh()}},getFeatureLayer:function(a){var b,d;for(b=0;b<this.featureLayers.length;b++)if(d=
this.featureLayers[b],void 0!==d&&d.id==a)return d;return null},removeFeatureLayer:function(a){var b;a=this.getFeatureLayer(a);if(void 0!==a&&(b=C.indexOf(this.featureLayers,a),-1<b)){this.featureLayers.splice(b,1);for(a=0;a<this._featureLayerInfos[b].EventHandlers.length;a++)D.disconnect(this._featureLayerInfos[b].EventHandlers[a]);this._featureLayerInfos.splice(b,1);this.refresh()}},removeAllFeatureLayers:function(){var a;for(a=0;a<this.featureLayers.length;a++){for(var b=0;b<this._featureLayerInfos[a].EventHandlers.length;b++)D.disconnect(this._featureLayerInfos[a].EventHandlers[b]);
this.featureLayers=[];this._featureLayerInfos=[]}this.refresh()},getFeatureLayers:function(){return this.featureLayers},getFeatureLayerInfo:function(a){var b,d;for(b=0;b<this.featureLayers.length;b++)if(d=this.featureLayers[b],void 0!==d&&d.id==a)return this._featureLayerInfos[b];return null},refresh:function(a){var b,d,f,g,k,h=[],m,l="DYNAMIC"===this._engineType?new c:new e;if(this._map){l.setMap(this._map,this);this._preparedLabels=[];for(a=0;a<this.featureLayers.length;a++)if(d=this.featureLayers[a],
d.visible&&d.showLabels&&d.visibleAtMapScale&&!d._suspended)if(b=this._featureLayerInfos[a],k=this._convertOptions(null),b.LabelRenderer){if(h=d.labelingInfo)if(m=h[0])g=this._getLabelExpression(m),k=this._convertOptions(m);f=b.LabelRenderer;b.LabelExpressionInfo&&(g=b.LabelExpressionInfo);b.LabelingOptions&&(k=this._convertOptions(null),void 0!==b.LabelingOptions.pointPriorities&&(h=b.LabelingOptions.pointPriorities,k.pointPriorities="above-center"==h||"AboveCenter"==h||"esriServerPointLabelPlacementAboveCenter"==
h?"AboveCenter":"above-left"==h||"AboveLeft"==h||"esriServerPointLabelPlacementAboveLeft"==h?"AboveLeft":"above-right"==h||"AboveRight"==h||"esriServerPointLabelPlacementAboveRight"==h?"AboveRight":"below-center"==h||"BelowCenter"==h||"esriServerPointLabelPlacementBelowCenter"==h?"BelowCenter":"below-left"==h||"BelowLeft"==h||"esriServerPointLabelPlacementBelowLeft"==h?"BelowLeft":"below-right"==h||"BelowRight"==h||"esriServerPointLabelPlacementBelowRight"==h?"BelowRight":"center-center"==h||"CenterCenter"==
h||"esriServerPointLabelPlacementCenterCenter"==h?"CenterCenter":"center-left"==h||"CenterLeft"==h||"esriServerPointLabelPlacementCenterLeft"==h?"CenterLeft":"center-right"==h||"CenterRight"==h||"esriServerPointLabelPlacementCenterRight"==h?"CenterRight":"AboveRight"),void 0!==b.LabelingOptions.lineLabelPlacement&&(k.lineLabelPlacement=b.LabelingOptions.lineLabelPlacement),void 0!==b.LabelingOptions.lineLabelPosition&&(k.lineLabelPosition=b.LabelingOptions.lineLabelPosition),void 0!==b.LabelingOptions.labelRotation&&
(k.labelRotation=b.LabelingOptions.labelRotation),void 0!==b.LabelingOptions.howManyLabels&&(k.howManyLabels=b.LabelingOptions.howManyLabels));f instanceof r&&(g=this._getLabelExpression(f),f=new q(f.symbol),k=this._convertOptions(f));this._addLabels(d,f,g,k)}else if(h=d.labelingInfo)for(b=h.length-1;0<=b;b--)if(m=h[b])f=new r(m instanceof r?m.toJson():m),g=this._getLabelExpression(m),k=this._convertOptions(m),this._addLabels(d,f,g,k);g=l._process(this._preparedLabels);this.clear();this.drawLabels(this._map,
g)}},drawLabels:function(a,b){this._scale=(a.extent.xmax-a.extent.xmin)/a.width;var d;for(d=0;d<b.length;d++){var e=b[d],f=e.x,c=e.y,h=e.text,m=e.angle,l=e.layer.labelSymbol;"polyline"==e.layer.geometry.type&&e.layer.options.labelRotation?l.setAngle(m*(180/Math.PI)):l.setAngle(0);l.setText(h);e=f;l instanceof k&&(f=l.getHeight(),m=Math.sin(m),e-=0.25*f*this._scale*m,c-=0.33*f*this._scale);m=new g(new n(e,c,a.extent.spatialReference));m.setSymbol(l);this.add(m)}},_addLabels:function(a,b,d,e){var f,
c,g,h;if(this._isWithinScaleRange(b.minScale,b.maxScale)&&d&&""!==d){var k=this._map,m=!a.url&&!k.spatialReference.equals(a.spatialReference);for(f=0;f<a.graphics.length;f++)if(c=a.graphics[f],!1!==c.visible){g=c.geometry;if(m){if(!l.canProject(g,k))continue;g=l.project(g,k)}g&&(this._isWhere(b.where,c.attributes)&&this._isWithinScreenArea(g))&&(h=this._buildLabelText(d,c.attributes,a.fields,e),this._addLabel(h,b,a.renderer,c,e,g,k))}}},_isWithinScreenArea:function(a){a="point"===a.type?new s(a.x,
a.y,a.x,a.y,a.spatialReference):a.getExtent();if(void 0===a)return!1;a=this._intersects(this._map,a);return null===a||0===a.length?!1:!0},_isWithinScaleRange:function(a,b){var d=this._map.getScale();return 0<a&&d>=a||0<b&&d<=b?!1:!0},_isWhere:function(a,b){try{if(!a)return!0;if(a){var d=a.split(" ");if(3===d.length)return this._sqlEquation(b[d[0].substr(1,d[0].length-2)],d[1],d[2]);if(7===d.length){var e=this._sqlEquation(b[d[0].substr(1,d[0].length-2)],d[1],d[2]),f=d[3],c=this._sqlEquation(b[d[4].substr(1,
d[4].length-2)],d[5],d[6]);switch(f){case "AND":return e&&c;case "OR":return e||c}}}return!1}catch(g){console.log("Error.: can't parse \x3d "+a)}},_sqlEquation:function(a,b,d){switch(b){case "\x3d":return a==d?!0:!1;case "\x3c\x3e":return a!=d?!0:!1;case "\x3e":return a>d?!0:!1;case "\x3e\x3d":return a>=d?!0:!1;case "\x3c":return a<d?!0:!1;case "\x3c\x3d":return a<=d?!0:!1}return!1},_getSizeInfo:function(a){return a?a.sizeInfo||C.filter(a.visualVariables,u)[0]:null},_addLabel:function(a,d,e,c,f,g,
h){var l,n,p,q;if(a&&""!==A.trim(a)&&d){a=a.replace(/\s+/g," ");l=d.getSymbol(c);l instanceof k?(l=new k(l.toJson()),l.setVerticalAlignment("baseline"),l.setHorizontalAlignment("center")):l=l instanceof m?new m(l.toJson()):new k;l.setText(a);d.symbol=l;if(p=this._getProportionalSize(d.sizeInfo,c.attributes))l instanceof k?l.setSize(p):l instanceof m&&(l.setWidth(p),l.setHeight(p));q=p=0;if(e){n=e.getSymbol(c);var r=this._getSizeInfo(e),s;r&&(s=e.getSize(c,{sizeInfo:r,resolution:h.getResolutionInMeters()}));
if(null!=s)p=q=s;else if(n)if("simplemarkersymbol"==n.type)q=p=n.size;else if("picturemarkersymbol"==n.type)p=n.width,q=n.height;else if("simplelinesymbol"==n.type||"cartographiclinesymbol"==n.type)p=n.width}e={};e.graphic=c;e.options=f;e.geometry=g;e.labelRenderer=d;e.labelSymbol=l;e.labelWidth=l.getWidth()/2;e.labelHeight=l.getHeight()/2;e.symbolWidth=b.normalizedLength(p)/2;e.symbolHeight=b.normalizedLength(q)/2;e.text=a;e.angle=l.angle;this._preparedLabels.push(e)}},_buildLabelText:function(a,
b,e,c){return a.replace(/{[^}]*}/g,function(a){var g,h=a;for(g=0;g<e.length;g++)if("{"+e[g].name+"}"==a){var h=b[e[g].name],k=e[g].domain;if(k&&A.isObject(k)){if("codedValue"==k.type)for(a=0;a<k.codedValues.length;a++)k.codedValues[a].code==h&&(h=k.codedValues[a].name);else"range"==k.type&&(k.minValue<=h&&h<=k.maxValue)&&(h=k.name);break}k=e[g].type;if(c.fieldInfos){var l=c.fieldInfos;for(g=0;g<l.length;g++)if("{"+l[g].fieldName+"}"==a){a=l[g].format;if("esriFieldTypeDate"==k)(a="DateFormat"+f.prototype._dateFormats[a.dateFormat?
a.dateFormat:"shortDate"])&&(h=d.substitute({myKey:h},"${myKey:"+a+"}"));else if(("esriFieldTypeInteger"==k||"esriFieldTypeSmallInteger"==k||"esriFieldTypeLong"==k||"esriFieldTypeDouble"==k)&&a)h=H.format(h,{places:a.places}),a.digitSeparator||E.group&&(h=h.replace(RegExp("\\"+E.group,"g"),""));break}}break}else h="";return null===h?"":h})},_getLabelExpression:function(a){return a.labelExpressionInfo?a.labelExpressionInfo.value:this._validSyntax(a.labelExpression)?this._convertLabelExpression(a.labelExpression):
""},_validSyntax:function(a){return/^(\s*\[[^\]]+\]\s*)+$/i.test(a)},_convertLabelExpression:function(a){return a.replace(RegExp("\\[","g"),"{").replace(RegExp("\\]","g"),"}")},_getProportionalSize:function(a,b){if(!a)return null;var e=d.substitute(b,"${"+a.field+"}",{first:!0});return!a.minSize||!a.maxSize||!a.minDataValue||!a.maxDataValue||!e||0>=a.maxDataValue-a.minDataValue?null:(a.maxSize-a.minSize)/(a.maxDataValue-a.minDataValue)*(e-a.minDataValue)+a.minSize},_convertOptions:function(a){var b=
"shortDate",d=null,e=null,c="",f=!0;a&&(a.format&&(b=a.format.dateFormat,d={places:a.format.places,digitSeparator:a.format.digitSeparator}),e=a.fieldInfos,c=a.labelPlacement);if("always-horizontal"==c||"esriServerPolygonPlacementAlwaysHorizontal"==c)f=!1;return{dateFormat:b,numberFormat:d,fieldInfos:e,pointPriorities:"above-center"==c||"esriServerPointLabelPlacementAboveCenter"==c?"AboveCenter":"above-left"==c||"esriServerPointLabelPlacementAboveLeft"==c?"AboveLeft":"above-right"==c||"esriServerPointLabelPlacementAboveRight"==
c?"AboveRight":"below-center"==c||"esriServerPointLabelPlacementBelowCenter"==c?"BelowCenter":"below-left"==c||"esriServerPointLabelPlacementBelowLeft"==c?"BelowLeft":"below-right"==c||"esriServerPointLabelPlacementBelowRight"==c?"BelowRight":"center-center"==c||"esriServerPointLabelPlacementCenterCenter"==c?"CenterCenter":"center-left"==c||"esriServerPointLabelPlacementCenterLeft"==c?"CenterLeft":"center-right"==c||"esriServerPointLabelPlacementCenterRight"==c?"CenterRight":"AboveRight",lineLabelPlacement:"above-start"==
c||"below-start"==c||"center-start"==c?"PlaceAtStart":"above-end"==c||"below-end"==c||"center-end"==c?"PlaceAtEnd":"PlaceAtCenter",lineLabelPosition:"above-after"==c||"esriServerLinePlacementAboveAfter"==c||"above-along"==c||"esriServerLinePlacementAboveAlong"==c||"above-before"==c||"esriServerLinePlacementAboveBefore"==c||"above-start"==c||"esriServerLinePlacementAboveStart"==c||"above-end"==c||"esriServerLinePlacementAboveEnd"==c?"Above":"below-after"==c||"esriServerLinePlacementBelowAfter"==c||
"below-along"==c||"esriServerLinePlacementBelowAlong"==c||"below-before"==c||"esriServerLinePlacementBelowBefore"==c||"below-start"==c||"esriServerLinePlacementBelowStart"==c||"below-end"==c||"esriServerLinePlacementBelowEnd"==c?"Below":"center-after"==c||"esriServerLinePlacementCenterAfter"==c||"center-along"==c||"esriServerLinePlacementCenterAlong"==c||"center-before"==c||"esriServerLinePlacementCenterBefore"==c||"center-start"==c||"esriServerLinePlacementCenterStart"==c||"center-end"==c||"esriServerLinePlacementCenterEnd"==
c?"OnLine":"Above",labelRotation:f,howManyLabels:"OneLabel"}}});h("extend-esri")&&A.setObject("layers.LabelLayer",B,a);return B});