// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See http://js.arcgis.com/3.14/esri/copyright.txt for details.
//>>built
define("esri/tasks/datareviewer/_DRSBaseTask","dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/Deferred dojo/has ../../request ../../urlUtils ../../kernel ../Task ./ReviewerSession".split(" "),function(k,b,q,m,s,n,p,t,u,r){k=k(u,{declaredClass:"esri.tasks.datareviewer.DRSBaseTask",_url:null,_queryParams:null,_reviewerMapServerUrl:null,constructor:function(a){"/"==a[a.length-1]&&(a=a.slice(0,-1));a=p.urlToObject(a);this._url=a.path;this._queryParams=a.query;a=this._url.toLowerCase().lastIndexOf("/exts/");
0<a&&(this._reviewerMapServerUrl=this._url.substring(0,a));this._successHandler=b.hitch(this,this._successHandler);this._errorHandler=b.hitch(this,this._errorHandler);this._appendQueryParams=b.hitch(this,this._appendQueryParams);this.onGetLifecycleStatusStringsComplete=b.hitch(this,this.onGetLifecycleStatusStringsComplete);this.onGetReviewerSessionsComplete=b.hitch(this,this.onGetReviewerSessionsComplete);this.onCreateReviewerSessionComplete=b.hitch(this,this.onCreateReviewerSessionComplete);this.onError=
b.hitch(this,this.onError)},_appendQueryParams:function(a){if(this._queryParams)for(var c in this._queryParams)a=p.urlToObject(a).query?a+("\x26"+c+"\x3d"+this._queryParams[c]):a+("?"+c+"\x3d"+this._queryParams[c]);return a},_successHandler:function(a,c,b){c&&this[c].apply(this,[a]);b&&b.resolve(a)},_errorHandler:function(a,c){null===a&&(a=Error("Unexpected response received from server"),a.code=500);this.onError(a);c&&c.reject(a)},getReviewerMapServerUrl:function(){var a=null;if(a=this._reviewerMapServerUrl){if(this._queryParams)for(var c in this._queryParams)a=
p.urlToObject(a).query?a+("\x26"+c+"\x3d"+this._queryParams[c]):a+("?"+c+"\x3d"+this._queryParams[c]);return a}return null},getLifecycleStatusStrings:function(){var a=this._successHandler,c=this._errorHandler,h=this._appendQueryParams,e=this._url+"/Utilities/getLifecycleStatusStrings",e=h(e),d=new m;n({callbackParamName:"callback",url:e,content:{f:"json"}}).then(b.hitch(this,function(g,b){if(void 0!==g.error){var f=Error();f.message=g.error.message;f.code=g.error.code;c(f,d)}else try{if(f=g.lifecycleStatusString,
void 0===f)c(null,d);else{var e=[];q.forEach(f,function(a,c){e[a.descriptionCode]=a.descriptionString});a({lifecycleStatusStrings:e},"onGetLifecycleStatusStringsComplete",d)}}catch(v){c(v,d)}}),function(a,b){c(a,d)});return d},createReviewerSession:function(a,c){var h=this._successHandler,e=this._errorHandler,d=this._appendQueryParams,g=this._url+"/Utilities/createReviewerSession",g=d(g),l=new m;n({callbackParamName:"callback",url:g,content:{sessionName:a,sessionProperties:c.toJsonSessionOptions(),
f:"json"}}).then(b.hitch(this,function(a,c){if(void 0!==a.error){var b=Error();b.message=a.error.message;b.code=a.error.code;e(b,l)}else try{if(void 0===a.sessionAttributes)e(null,l);else{var b=a.sessionAttributes,d=new r(b.sessionId,b.sessionName,b.userName,b.versionName);h({reviewerSession:d},"onCreateReviewerSessionComplete",l)}}catch(g){e(g,l)}}),function(a,c){e(a,l)});return l},getReviewerSessions:function(){var a=this._successHandler,c=this._errorHandler,h=this._appendQueryParams,e=this._url+
"/Utilities/getReviewerSessions",e=h(e),d=new m;n({callbackParamName:"callback",url:e,content:{f:"json"}}).then(b.hitch(this,function(b,e){if(void 0!==b.error){var f=Error();f.message=b.error.message;f.code=b.error.code;c(f,d)}else try{if(f=b.sessionAttributes,void 0===f)c(null,d);else{var h=[];q.forEach(f,function(a,b){h[b]=new r(a.sessionId,a.sessionName,a.userName,a.versionName)});a({reviewerSessions:h},"onGetReviewerSessionsComplete",d)}}catch(k){c(k,d)}}),function(a,b){c(a,d)});return d},onGetLifecycleStatusStringsComplete:function(a){},
onGetReviewerSessionsComplete:function(a){},onCreateReviewerSessionComplete:function(a){},onError:function(a){}});s("extend-esri")&&b.setObject("tasks.datareviewer.DRSBaseTask",k,t);return k});