// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See http://js.arcgis.com/3.14/esri/copyright.txt for details.
//>>built
require({cache:{"url:esri/dijit/templates/ImageServiceMeasure.html":'\x3cdiv data-dojo-attach-point\x3d"esriImageServiceMeasure" class\x3d"esriImageServiceMeasure"\x3e\r\n    \x3cdiv class\x3d"esriImageServiceMeasureDropdownContainer" data-dojo-attach-point\x3d"measureDropDownContainer"\x3e\r\n    \x3c/div\x3e\r\n\x3c/div\x3e\r\n'}});
define("esri/dijit/ImageServiceMeasure","dojo/_base/declare dojo/_base/lang dojo/i18n!../nls/jsapi dojo/text!./templates/ImageServiceMeasure.html dojo/has ../kernel dijit/_WidgetBase dijit/_TemplatedMixin dijit/_WidgetsInTemplateMixin ../toolbars/ImageServiceMeasureTool dijit/form/DropDownButton dijit/DropDownMenu dijit/MenuItem dijit/MenuSeparator dijit/PopupMenuItem dijit/RadioMenuItem dijit/CheckedMenuItem ../symbols/SimpleMarkerSymbol ../symbols/SimpleLineSymbol ../symbols/SimpleFillSymbol ../graphic ../geometry/Point dojo/_base/Color dojo/dom-class dojo/dom dojo/_base/array".split(" "),function(s,
e,v,l,w,x,y,z,A,B,C,m,D,t,q,r,E,F,n,u,G,H,p,c,I,k){l=s([y,z,A],{declaredClass:"esri.dijit.ImageServiceMeasure",templateString:l,widgetsInTemplate:!0,layer:null,map:null,_supportedMeasureOperations:[],_supportedUnits:{},markerSymbol:null,lineSymbol:null,fillSymbol:null,_currentGraphic:null,_currentUnits:{angularUnit:"esriDUDecimalDegrees",linearUnit:"esriMeters",areaUnit:"esriSquareMeters"},_desiredDropDownOrder:"OPERATION_POINT OPERATION_DISTANCE_ANGLE OPERATION_AREA_PERIMETER OPERATION_CENTROID OPERATION_BASE_TOP OPERATION_TOP_TOP_SHADOW OPERATION_BASE_TOP_SHADOW".split(" "),
_map3DOperations:{OPERATION_POINT:"OPERATION_POINT_3D",OPERATION_DISTANCE_ANGLE:"OPERATION_DISTANCE_ANGLE_3D",OPERATION_AREA_PERIMETER:"OPERATION_AREA_PERIMETER_3D",OPERATION_CENTROID:"OPERATION_CENTROID_3D",OPERATION_BASE_TOP:"OPERATION_BASE_TOP",OPERATION_TOP_TOP_SHADOW:"OPERATION_TOP_TOP_SHADOW",OPERATION_BASE_TOP_SHADOW:"OPERATION_BASE_TOP_SHADOW"},_menu:null,_button:null,_currentOperation:null,_activeMeasureOpMenuItem:null,_has3DOperations:!1,_enabled3DCheckbox:!1,constructor:function(a){s.safeMixin(this,
a);this._setDefaultSymbols();this._i18n=v},startup:function(){this.inherited(arguments)},postCreate:function(){this.map&&this.layer&&(this.measureToolbar=new B({map:this.map,layer:this.layer}),this.measureToolbar.on("draw-end",e.hitch(this,this._addGraphic)),this.measureToolbar.on("draw-start",e.hitch(this,this._onDrawStart)),this.measureToolbar.on("measure-end",e.hitch(this,this._addInfoWindow)),this.measureToolbar.on("unit-change",e.hitch(this,this._onUnitChange)),this._supportedMeasureOperations=
this.measureToolbar.getSupportedMeasureOperations(),this._has3DOperations=this._check3DSupported(),this._reorderMeasureOperations(),this._supportedUnits=this.measureToolbar.getSupportedUnits());this._populateMeasureDropdown()},_check3DSupported:function(){return-1<this._supportedMeasureOperations.indexOf("OPERATION_POINT_3D")},_reorderMeasureOperations:function(){var a=[];k.forEach(this._desiredDropDownOrder,function(b,g){-1<this._supportedMeasureOperations.indexOf(b)&&a.push(b)},this);this._supportedMeasureOperations=
a},_setDefaultSymbols:function(){this.markerSymbol||(this.markerSymbol=new F,this.markerSymbol.setPath("M16,4.938c-7.732,0-14,4.701-14,10.5c0,1.981,0.741,3.833,2.016,5.414L2,25.272l5.613-1.44c2.339,1.316,5.237,2.106,8.387,2.106c7.732,0,14-4.701,14-10.5S23.732,4.938,16,4.938zM16.868,21.375h-1.969v-1.889h1.969V21.375zM16.772,18.094h-1.777l-0.176-8.083h2.113L16.772,18.094z"),this.markerSymbol.setColor(new p("#00FFFF")));this.lineSymbol||(this.lineSymbol=new n(n.STYLE_SOLID,new p([255,0,0]),1.5));this.fillSymbol||
(this.fillSymbol=new u(u.STYLE_SOLID,new n(n.STYLE_DASHDOT,new p([255,0,0]),2),new p([255,255,0,0.25])))},_populateMeasureDropdown:function(){var a,b,g,c,h,d;this._menu=new m({style:"display: none;"});k.forEach(this._supportedMeasureOperations,function(b){a=new D({label:this._i18n.widgets.imageServiceMeasure.operationLabel[b],iconClass:"esri"+b});a.on("click",e.hitch(this,this._onMenuItemClick,b,a));this._menu.addChild(a)},this);b=new t;this._menu.addChild(b);this._has3DOperations&&(b=new E({label:this._i18n.widgets.imageServiceMeasure.measure3DLabel,
checked:!1}),b.on("change",e.hitch(this,this._on3DCheckBoxChange)),this._menu.addChild(b),b=new t,this._menu.addChild(b));g=new m({style:"display: none;"});k.forEach(this._supportedUnits.angularUnits,function(b){d=this._isCurrentAngularUnit(b);a=new r({group:"angularUnit",checked:d,label:this._i18n.widgets.imageServiceMeasure.unitLabel[b],"class":d?"esriSelectedOption":""});d&&(this._currentAngularUnitMenuItem=a);a.on("click",e.hitch(this,this._onAngularUnitClick,b,a));g.addChild(a)},this);b=new q({label:this._i18n.widgets.imageServiceMeasure.angularUnits,
popup:g});this._menu.addChild(b);c=new m({style:"display: none;"});k.forEach(this._supportedUnits.linearUnits,function(b){d=this._isCurrentLinearUnit(b);a=new r({group:"linearUnit",checked:d,label:this._i18n.widgets.imageServiceMeasure.unitLabel[b],"class":d?"esriSelectedOption":""});d&&(this._currentLinearUnitMenuItem=a);a.on("click",e.hitch(this,this._onLinearUnitClick,b,a));c.addChild(a)},this);b=new q({label:this._i18n.widgets.imageServiceMeasure.linearUnits,popup:c});this._menu.addChild(b);h=
new m({style:"display: none;"});k.forEach(this._supportedUnits.areaUnits,function(b){d=this._isCurrentAreaUnit(b);a=new r({group:"areaUnit",checked:d,label:this._i18n.widgets.imageServiceMeasure.unitLabel[b],"class":d?"esriSelectedOption":""});d&&(this._currentAreaUnitMenuItem=a);a.on("click",e.hitch(this,this._onAreaUnitClick,b,a));h.addChild(a)},this);b=new q({label:this._i18n.widgets.imageServiceMeasure.areaUnits,popup:h});this._menu.addChild(b);this._button=new C({label:this._i18n.widgets.imageServiceMeasure.measureBtnText,
dropDown:this._menu,iconClass:"esriMeasureIcon"},this.measureDropDownContainer);this._button.startup()},_on3DCheckBoxChange:function(a){this._enabled3DCheckbox=a;this._button.openDropDown();this._currentOperation&&(this._activeMeasureOpMenuItem=null,this._onMenuItemClick(this._currentOperation.replace("_3D","")))},_onMenuItemClick:function(a,b){this._enabled3DCheckbox&&(a=this._map3DOperations[a]);var g=b.domNode;this.map.disableMapNavigation();this._currentGraphic&&(this.map.graphics.remove(this._currentGraphic),
this._currentGraphic=null);this._currentInfowindow&&(this.map.infoWindow.hide(this._currentInfowindow),this._currentInfowindow=null);this._activeMeasureOpMenuItem?this._currentOperation===a||this._currentOperation===a.replace("_3D","")?(c.remove(this._activeMeasureOpMenuItem.domNode,"esriSelectedOption"),this._activeMeasureOpMenuItem=this._currentOperation=null,this.measureToolbar.deactivate(),this._button.set({label:this._i18n.widgets.imageServiceMeasure.measureBtnText,iconClass:"esriMeasureIcon"}),
c.remove(this._button._buttonNode,"esriCheckedMeasureButton"),this.map.enableMapNavigation()):(c.remove(this._activeMeasureOpMenuItem.domNode,"esriSelectedOption"),c.add(g,"esriSelectedOption"),this._activeMeasureOpMenuItem=b,this._currentOperation=a,this._button.set({label:this._i18n.widgets.imageServiceMeasure.operationLabel[a],iconClass:"esri"+a.replace("_3D","")}),this.measureToolbar.activate(a),this.measureToolbar.showDrawTooltip()):(this._activeMeasureOpMenuItem=b,c.add(g,"esriSelectedOption"),
this._currentOperation=a,this._button.set({label:this._i18n.widgets.imageServiceMeasure.operationLabel[a],iconClass:"esri"+a.replace("_3D","")}),c.add(this._button._buttonNode,"esriCheckedMeasureButton"),this.measureToolbar.activate(a),this.measureToolbar.showDrawTooltip())},_isCurrentAngularUnit:function(a){return a==this._currentUnits.angularUnit?!0:!1},_isCurrentLinearUnit:function(a){return a==this._currentUnits.linearUnit?!0:!1},_isCurrentAreaUnit:function(a){return a==this._currentUnits.areaUnit?
!0:!1},_onLinearUnitClick:function(a,b){c.remove(this._currentLinearUnitMenuItem.domNode,"esriSelectedOption");c.add(b.domNode,"esriSelectedOption");this._currentLinearUnitMenuItem=b;this._currentUnits.linearUnit=a;this.measureToolbar.setLinearUnit(a);this._button.openDropDown()},_onAngularUnitClick:function(a,b){c.remove(this._currentAngularUnitMenuItem.domNode,"esriSelectedOption");c.add(b.domNode,"esriSelectedOption");this._currentAngularUnitMenuItem=b;this._currentUnits.angularUnit=a;this.measureToolbar.setAngularUnit(a);
this._button.openDropDown()},_onAreaUnitClick:function(a,b){c.remove(this._currentAreaUnitMenuItem.domNode,"esriSelectedOption");c.add(b.domNode,"esriSelectedOption");this._currentAreaUnitMenuItem=b;this._currentUnits.areaUnit=a;this.measureToolbar.setAreaUnit(a);this._button.openDropDown()},_onDrawStart:function(){this._currentGraphic&&(this.map.graphics.remove(this._currentGraphic),this._currentGraphic=null);this._currentInfowindow&&(this.map.infoWindow.hide(this._currentInfowindow),this._currentInfowindow=
null)},_addGraphic:function(a){var b=a.geometry;this.measureToolbar.hideDrawTooltip();a="point"===b.type?this.markerSymbol:"line"===b.type||"polyline"===b.type?this.lineSymbol:this.fillSymbol;this._currentGraphic&&(this.map.graphics.remove(this._currentGraphic),this._currentGraphic=null);this._currentInfowindow&&(this.map.infoWindow.hide(this._currentInfowindow),this._currentInfowindow=null);this._currentGraphic=a=new G(b,a);this.map.graphics.add(a)},_addInfoWindow:function(a){var b="",c,e,h,d,f;
if(a.measureResult)for(f in a=a.measureResult,a)a.hasOwnProperty(f)&&(a[f]&&"name"!==f&&"sensorName"!==f)&&("point"!=f?(d=f.charAt(0).toUpperCase()+f.slice(1),c=this._i18n.widgets.imageServiceMeasure.unitLabel[a[f].unit],h=Math.abs(a[f].uncertainty).toFixed(2),e=Math.abs(a[f].value).toFixed(2),b+="\x3cstrong\x3e"+d+"\x3c/strong\x3e: "+e+" (\x26plusmn"+h+") "+c+"\x3cbr/\x3e"):(d=f.charAt(0).toUpperCase()+f.slice(1),c=a[f].value.x.toFixed(2),e=a[f].value.y.toFixed(2),b+="\x3cstrong\x3e"+d+"\x3c/strong\x3e\x3cbr/\x3eX : "+
c+"\x3cbr/\x3eY : "+e+"\x3cbr/\x3e"));else b=a.error.message;this._displayMeasureResult(b)},_displayMeasureResult:function(a){if(this._currentGraphic){var b=this._currentGraphic.geometry,c;"point"===b.type?this._currentInfowindow=b:"polyline"===b.type?(c=(b.paths[0][0][0]+b.paths[0][1][0])/2,b=(b.paths[0][0][1]+b.paths[0][1][1])/2,this._currentInfowindow=new H(c,b,this.map.spatialReference)):"polygon"===b.type&&(this._currentInfowindow=b.getCentroid());this.map.infoWindow.setTitle(this._i18n.widgets.imageServiceMeasure.infoWindowTitle);
this.map.infoWindow.setContent(a);this.map.infoWindow.on("hide",e.hitch(this,this._removeAssociatedGeometry));this.map.infoWindow.show(this._currentInfowindow)}},_removeAssociatedGeometry:function(){this._currentGraphic&&(this.map.graphics.remove(this._currentGraphic),this._currentGraphic=null)},_onUnitChange:function(a){this._addInfoWindow(a)},destroy:function(){this.inherited(arguments)}});w("extend-esri")&&e.setObject("dijit.ImageServiceMeasure",l,x);return l});