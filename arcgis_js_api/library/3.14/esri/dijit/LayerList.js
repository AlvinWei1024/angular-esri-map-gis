// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See http://js.arcgis.com/3.14/esri/copyright.txt for details.
//>>built
require({cache:{"url:esri/dijit/LayerList/templates/LayerList.html":'\x3cdiv class\x3d"${theme}" role\x3d"presentation"\x3e\r\n  \x3cdiv data-dojo-attach-point\x3d"_container" class\x3d"${css.container}"\x3e\r\n    \x3cul class\x3d"${css.list}" data-dojo-attach-point\x3d"_layersNode"\x3e\x3c/ul\x3e\r\n    \x3cdiv class\x3d"${css.noLayersText}" data-dojo-attach-point\x3d"_noLayersNode"\x3e\x3c/div\x3e\r\n  \x3c/div\x3e\r\n\x3c/div\x3e'}});
define("esri/dijit/LayerList","dojo/_base/array dojo/_base/declare dojo/_base/lang ../kernel dojo/uacss dojo/Deferred dojo/on dojo/dom-class dojo/dom-style dojo/dom-construct dojo/dom-attr dojo/i18n!../nls/jsapi dijit/_WidgetBase dijit/_TemplatedMixin ../promiseList dojo/text!./LayerList/templates/LayerList.html".split(" "),function(l,t,h,B,C,x,m,v,A,k,r,D,E,F,G,H){t=t([E,F],{templateString:H,defaults:{theme:"esriLayerList",map:null,layers:null,subLayers:!0,removeUnderscores:!0,visible:!0},constructor:function(a){a=
h.mixin({},this.defaults,a);this.set(a);this.css={container:"esriContainer",noLayers:"esriNoLayers",noLayersText:"esriNoLayersText",list:"esriList",subList:"esriSubList",subListLayer:"esriSubListLayer",layer:"esriLayer",layerScaleInvisible:"esriScaleInvisible",title:"esriTitle",titleContainer:"esriTitleContainer",checkbox:"esriCheckbox",label:"esriLabel",button:"esriButton",content:"esriContent",clear:"esriClear"}},postCreate:function(){this.inherited(arguments);var a=this;this.own(m(this._layersNode,
"."+this.css.checkbox+":click",function(){var c,b;c=r.get(this,"data-layer-index");b=r.get(this,"data-sublayer-index");a._toggleLayer(c,b)}))},startup:function(){this.inherited(arguments);this._mapLoaded(this.map).then(h.hitch(this,this._init))},destroy:function(){this._removeEvents();this.inherited(arguments)},refresh:function(){var a=this.layers;this._nodes=[];var c=[];if(a&&a.length)for(var b=0;b<a.length;b++)c.push(this._layerLoaded(b));return G(c).always(h.hitch(this,function(a){this._loadedLayers=
a;this._removeEvents();this._createLayerNodes();this._setLayerEvents();this.emit("refresh")}))},_mapLoaded:function(a){var c=new x;if(a)if(a.loaded)c.resolve();else m.once(a,"load",h.hitch(this,function(){c.resolve()}));else c.resolve();return c.promise},_layerLoaded:function(a){var c=this.layers[a],b=c.layer,d={layer:b,layerInfo:c,layerIndex:a},f=new x;if(b)if(b.loaded)f.resolve(d);else if(b.loadError)f.reject(b.loadError);else{var e,g;e=m.once(b,"load",h.hitch(this,function(){g.remove();f.resolve(d)}));
g=m.once(b,"error",h.hitch(this,function(a){e.remove();f.reject(a)}))}else f.resolve(d);return f.promise},_checkboxStatus:function(a){return!!a.visibility},_WMSVisible:function(a,c){var b=[];a&&a.layer&&(b=a.layer.visibleLayers);return-1<l.indexOf(b,c.name)},_subCheckboxStatus:function(a,c){var b;switch(a.layer.declaredClass){case "esri.layers.KMLLayer":b=c.visible;break;case "esri.layers.WMSLayer":b=this._WMSVisible(a,c);break;default:b=c.defaultVisibility}return b},_getLayerTitle:function(a){var c=
"",b=a.layer;(a=a.layerInfo)&&a.title?c=a.title:b&&b.arcgisProps&&b.arcgisProps.title?c=b.arcgisProps.title:b&&b.name?c=b.name:a&&a.id?c=a.id:b&&b.id&&(c=b.id);return this.removeUnderscores?c.replace(/_/g," "):c},_showSublayers:function(a){return a.hasOwnProperty("subLayers")?a.subLayers:this.subLayers},_createLayerNodes:function(){this._layersNode.innerHTML="";this._noLayersNode.innerHTML="";v.remove(this._container,this.css.noLayers);var a=this._loadedLayers;if(a&&a.length)for(var c=0;c<a.length;c++){var b=
a[c];if(b){var d=b.layer,f=b.layerIndex,e=b.layerInfo;if(e){if(e.featureCollection&&!e.hasOwnProperty("visibility")){var g=e.featureCollection.layers[0];g&&g.layerObject&&(e.visibility=g.layerObject.visible)}d&&!e.hasOwnProperty("visibility")&&(e.visibility=e.layer.visible);d&&!e.hasOwnProperty("id")&&(e.id=e.layer.id);var p,h=k.create("li",{className:this.css.layer});d&&!d.visibleAtMapScale&&v.add(h,this.css.layerScaleInvisible);k.place(h,this._layersNode,"first");p=k.create("div",{className:this.css.title},
h);var g=[],l;d&&(l=d.declaredClass);var m=this._checkboxStatus(e),s=k.create("div",{className:this.css.titleContainer},p),u=this.id+"_checkbox_"+f,n=k.create("input",{type:"checkbox",id:u,"data-layer-index":f,className:this.css.checkbox},s);r.set(n,"checked",m);var t;e.button&&(t=k.create("div",{className:this.css.button},s),k.place(e.button,t));b=this._getLayerTitle(b);b=k.create("label",{className:this.css.label,textContent:b},s);r.set(b,"for",u);var u=k.create("div",{className:this.css.clear},
s),z;e.content&&(z=k.create("div",{className:this.css.content},p),k.place(e.content,z));this._nodes[f]={checkbox:n,title:p,titleContainer:s,label:b,layer:h,clear:u,button:t,content:z,subNodes:g};if(d&&(p=d.layerInfos,"esri.layers.KMLLayer"===l&&(p=d.folders),this._showSublayers(e)&&"esri.layers.ArcGISTiledMapServiceLayer"!==l&&p&&p.length)){d=k.create("ul",{className:this.css.subList},h);for(h=0;h<p.length;h++){var q=p[h],w,n=-1,s=null;"esri.layers.ArcGISDynamicMapServiceLayer"===l?(w=q.id,n=q.parentLayerId):
"esri.layers.KMLLayer"===l?(w=q.id,n=q.parentFolderId):"esri.layers.WMSLayer"===l&&(w=q.name,n=-1);-1!==n&&(s=k.create("ul",{className:this.css.subList},this._nodes[f].subNodes[n].subLayer));var x=this._subCheckboxStatus(e,q),y=this.id+"_checkbox_sub_"+f+"_"+w,n=k.create("li",{className:this.css.subListLayer},s||d),u=k.create("div",{className:this.css.title},n),b=k.create("div",{className:this.css.titleContainer},u),m=k.create("input",{type:"checkbox",id:y,"data-layer-index":f,"data-sublayer-index":w,
className:this.css.checkbox},b);r.set(m,"checked",x);q=k.create("label",{className:this.css.label,textContent:q.name||""},b);r.set(q,"for",y);y=k.create("div",{className:this.css.clear},b);g[w]={subList:d,subSubList:s,subLayer:n,subTitle:u,subTitleContainer:b,subCheckbox:m,subLabel:q,subClear:y}}}}}}else v.add(this._container,this.css.noLayers),r.set(this._noLayersNode,"textContent",D.widgets.layerList.noLayers)},_removeEvents:function(){if(this._layerEvents&&this._layerEvents.length)for(var a=0;a<
this._layerEvents.length;a++)this._layerEvents[a].remove();this._layerEvents=[]},_emitToggle:function(a,c,b){this.emit("toggle",{layerIndex:a,subLayerIndex:c,visible:b})},_toggleVisible:function(a,c){var b=this._nodes[a].checkbox;r.get(b,"checked")!==c&&(r.set(b,"checked",c),this._emitToggle(a,null,c))},_layerVisChangeEvent:function(a,c,b){b=c?a.layerInfo.featureCollection.layers[b].layer:a.layer;var d=m(b,"visibility-change",h.hitch(this,function(b){c?this._featureCollectionVisible(a.layerIndex,
b.visible):this._toggleVisible(a.layerIndex,b.visible)}));this._layerEvents.push(d);c||(b=m(b,"scale-visibility-change",h.hitch(this,function(b){v.toggle(this._nodes[a.layerIndex].layer,this.css.layerScaleInvisible,!b.target.visibleAtMapScale)})),this._layerEvents.push(b))},_layerEvent:function(a){var c=a.layerInfo;if(c.featureCollection&&c.featureCollection.layers&&c.featureCollection.layers.length){if((c=c.featureCollection.layers)&&c.length)for(var b=0;b<c.length;b++)this._layerVisChangeEvent(a,
!0,b)}else this._layerVisChangeEvent(a)},_toggleLayer:function(a,c){if(this.layers&&this.layers.length){var b,d=this.layers[parseInt(a,10)],f=d.layer,e;f&&(e=f.declaredClass);var g=d.featureCollection;if(g){b=!d.visibility;d.visibility=b;for(d=0;d<g.layers.length;d++)g.layers[d].layerObject.setVisibility(b)}else if(f)if(null!==c)if("esri.layers.ArcGISDynamicMapServiceLayer"===e){c=parseInt(c,10);e=f.layerInfos;g=[-1];b=!e[c].defaultVisibility;e[c].defaultVisibility=b;for(d=0;d<e.length;d++){var h=
e[d];h.defaultVisibility&&(g.push(h.id),h=l.lastIndexOf(g,-1),-1!==h&&g.splice(h,1))}e=[];for(d=0;d<g.length;d++)h=g[d],this._allIdsPresent(f,h,g)&&e.push(h);d=[];for(g=0;g<e.length;g++)(h=this._getLayerInfo(f,e[g]))&&null===h.subLayerIds&&d.push(e[g]);d.length||(d=[-1]);f.setVisibleLayers(d)}else if("esri.layers.KMLLayer"===e){c=parseInt(c,10);g=f.folders;for(d=0;d<g.length;d++)if(e=g[d],e.id===c){f.setFolderVisibility(e,!e.visible);break}}else"esri.layers.WMSLayer"===e&&(g=f.visibleLayers,d=l.indexOf(g,
c),-1===d?g.push(c):g.splice(d,1),f.setVisibleLayers(g));else b=!f.visible,d.visibility=b,f.setVisibility(b);else b=!d.visible,d.setVisibility(b);this._emitToggle(a,c,b)}},_featureCollectionVisible:function(a,c){var b=this.layers[a],d=b.visibleLayers,f=b.featureCollection.layers;(d&&d.length?l.every(d,function(a){return f[a].layer.visible===c}):l.every(f,function(a){return a.layer.visible===c}))&&this._toggleVisible(a,c)},_setLayerEvents:function(){var a=this._loadedLayers;if(a&&a.length)for(var c=
0;c<a.length;c++){var b=a[c];b.layer&&this._layerEvent(b)}},_allIdsPresent:function(a,c,b){a=this._walkUpLayerIds(a,c);return l.every(a,function(a){return-1<l.indexOf(b,a)})},_walkUpLayerIds:function(a,c){var b=this._getLayerInfo(a,c),d=[];if(b)for(;-1!==b.parentLayerId;)(b=this._getLayerInfo(a,b.parentLayerId))&&d.push(b.id);return d},_getLayerInfo:function(a,c){for(var b,d=0;d<a.layerInfos.length;d++){var f=a.layerInfos[d];if(f.id===c){b=f;break}}return b},_isSupportedLayerType:function(a){return a&&
!a._basemapGalleryLayerType||a&&"basemap"!==a._basemapGalleryLayerType},_createLayerInfo:function(a){return{layer:a}},_updateAllMapLayers:function(){if(this.map&&(!this.layers||!this.layers.length)){var a=[];l.forEach(this.map.layerIds,function(c){c=this.map.getLayer(c);this._isSupportedLayerType(c)&&a.push(this._createLayerInfo(c))},this);l.forEach(this.map.graphicsLayerIds,function(c){c=this.map.getLayer(c);this._isSupportedLayerType(c)&&(c._params&&c._params.drawMode)&&a.push(this._createLayerInfo(c))},
this);this._set("layers",a)}},_init:function(){this._visible();this._updateAllMapLayers();this.refresh().always(h.hitch(this,function(){this.set("loaded",!0);this.emit("load")}))},_visible:function(){this.visible?A.set(this.domNode,"display","block"):A.set(this.domNode,"display","none")},_setThemeAttr:function(a){this.domNode&&(v.remove(this.domNode,this.theme),v.add(this.domNode,a));this._set("theme",a)},_setMapAttr:function(a){this._set("map",a);this._created&&this._mapLoaded(this.map).then(h.hitch(this,
function(){this._updateAllMapLayers();this.refresh()}))},_setLayersAttr:function(a){this._set("layers",a);this._created&&this.refresh()},_setRemoveUnderscoresAttr:function(a){this._set("removeUnderscores",a);this._created&&this.refresh()},_setSubLayersAttr:function(a){this._set("subLayers",a);this._created&&this.refresh()},_setVisibleAttr:function(a){this._set("visible",a);this._created&&this._visible()}});C("extend-esri")&&h.setObject("dijit.LayerList",t,B);return t});