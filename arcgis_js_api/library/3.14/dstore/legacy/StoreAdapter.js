//>>built
define("dstore/legacy/StoreAdapter","dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/when ../Store ../QueryResults".split(" "),function(g,b,l,m,q,r){b=function(a){return function(){var c=this.objectStore;return c[a].apply(c,arguments)}};return g(q,{objectStore:null,get:function(){var a=this,c=this.objectStore;return m(c.get.apply(c,arguments),function(c){return a._restore(c)})},put:b("put"),add:b("add"),remove:b("remove"),getIdentity:b("getIdentity"),_setIdentity:function(a,c){return a[this.objectStore.idProperty]=
c},fetch:function(){return this.fetchRange()},fetchRange:function(a){function c(a){for(var b=0;b<a.length;b++){var d=a[b],e=d.type,d=d.args;if("and"===e)c(d);else if("eq"===e||"match"===e)h[d[0]]=d[1];else if("string"===e)h=d[0];else if(e)throw Error('"'+e+" operator can not be converted to a legacy store query");}}var b={},g=this.queryLog,n=function(a){return l.map(l.filter(g,function(b){return b.type===a}),function(a){return a.normalizedArguments[0]})},f=n("sort").pop();if(f&&(b.sort=f,f instanceof
Array))for(var k=0;k<f.length;k++){var p=f[k];p.attribute=p.property}a&&(b.count=a.end-((b.start=a.start)||0));var h={};c(n("filter"));return(a=this.objectStore.query(h,b))?new r(a.map(this._restore,this),{totalLength:m(a.total)}):a}})});